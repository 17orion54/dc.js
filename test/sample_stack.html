<html>
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="../node_modules/d3/d3.js"></script>
    <script type="text/javascript" src="../node_modules/crossfilter/crossfilter.js"></script>

    <script type="text/javascript" src="../dc.js"></script>
    <link rel="stylesheet" type="text/css" href="dc.css"/>
</head>
<body>
<div id="stackChart"></div>
<div id="barChart"></div>
<script type="text/javascript">
    var data = [
        {
            "day": 1371600000000,
            "version": "4.3",
            "count": 6
        },
        {
            "day": 1371513600000,
            "version": "4.3",
            "count": 6
        },
        {
            "day": 1371427200000,
            "version": "4.3",
            "count": 4
        },
        {
            "day": 1371340800000,
            "version": "4.3",
            "count": 3
        },
        {
            "day": 1371254400000,
            "version": "4.3",
            "count": 3
        },
        {
            "day": 1371168000000,
            "version": "4.3",
            "count": 2
        },
        {
            "day": 1371081600000,
            "version": "4.3",
            "count": 2
        },
        {
            "day": 1370995200000,
            "version": "4.3",
            "count": 2
        },
        {
            "day": 1371600000000,
            "version": "4.2",
            "count": 2
        },
        {
            "day": 1371513600000,
            "version": "4.2",
            "count": 2
        },
        {
            "day": 1371427200000,
            "version": "4.2",
            "count": 2
        },
        {
            "day": 1371340800000,
            "version": "4.2",
            "count": 2
        },
        {
            "day": 1371254400000,
            "version": "4.2",
            "count": 2
        },
        {
            "day": 1371168000000,
            "version": "4.2",
            "count": 1
        },
        {
            "day": 1371081600000,
            "version": "4.2",
            "count": 0
        },
        {
            "day": 1370995200000,
            "version": "4.2",
            "count": 0
        },
    ];

    var ndx = crossfilter(data);

    var day = ndx.dimension(function (d) {
        return new Date(d.day);
    });

    var version = ndx.dimension(function (d) {
           return d.version;
       });

    var stack0 = day.group().reduceSum(function (d) {
        if (d.version === '4.2') {
            return d.count;
        }

        return 0;
    });
    var stack1 = day.group().reduceSum(function (d) {
        if (d.version === '4.3') {
            return d.count;
        }

        return 0;
    });

    var chart1 = dc.lineChart("#stackChart")
            .width(900)
            .height(250)
            .dimension(day)
            .group(stack0)
            .stack(stack1)
            .stack(stack1)
            .elasticY(true)
            .x(d3.time.scale().domain([new Date(1370995200000), new Date(1371700000000)]))
            .round(d3.time.day.round)
            .xUnits(d3.time.days)
            .renderHorizontalGridLines(true)
            .renderArea(true)
            .brushOn(false)
            .renderTitle(true)
            .dotRadius(10);

    var chart2 = dc.barChart("#barChart")
                .width(900)
                .height(250)
                .gap(5)
                .dimension(day)
                .group(stack0)
                .stack(stack1)
                .elasticY(false)
                .x(d3.time.scale().domain([new Date(1370995200000), new Date(1371700000000)]))
                .xUnits(d3.time.days)
                .renderHorizontalGridLines(true)
                .renderTitle(true);

    dc.renderAll();


</script>
</body>
</html>
