<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Nasdaq 100 Index</title>

    <script type="text/javascript" src="../node_modules/jquery/tmp/jquery.js"></script>
    <script type="text/javascript" src="../node_modules/d3/d3.v2.js"></script>
    <script type="text/javascript" src="../node_modules/crossfilter/crossfilter.js"></script>

    <script type="text/javascript" src="../dc.js"></script>
    <script type="text/javascript" src="env-data.js"></script>

    <link rel="stylesheet" type="text/css" href="dc.css"/>
</head>
<body>

<h1>Nasdaq 100 Index 1985/11/01-2012/06/29</h1>

<div id="bar-chart-volume" class="chart">
    <span>Trade Volume by Month</span>
    <a class="reset" href="javascript:volumeByMonthChart.filterAll();dc.redrawAll();" style="display: none;">reset</a>

    <div class="clear"></div>
</div>

<script type="text/javascript">
    var volumeByMonthChart = dc.barChart("#bar-chart-volume");

    d3.csv("ndx.csv", function(data) {
                var dateFormat = d3.time.format("%m/%d/%Y");
                data.forEach(function(e) {
                    e.month = d3.time.month(dateFormat.parse(e.date));
                });

                var ndx = crossfilter(data);

                var recordByMonth = ndx.dimension(function(d) {
                    return d.month;
                });
                var volumeByMonth = recordByMonth.group().reduceSum(function(d) {
                    return d.volume;
                });

                console.log("done crossfiltering");

                volumeByMonthChart.width(1100)
                        .height(250)
                        .margins( {top: 10, right: 50, bottom: 30, left: 40})
                        .dimension(recordByMonth)
                        .group(volumeByMonth)
                        .x(d3.time.scale().domain([new Date(1985, 0, 1), new Date(2012, 11, 31)]))
                        .xUnits(d3.time.months)
                        .axisX();

                dc.renderAll();
            }
    );
</script>

<div class="clear"></div>

<div>
    <a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a>
</div>

</body>
</html>