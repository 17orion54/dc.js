<!DOCTYPE html>
<html lang="en">
<head>
    <title>dc.js - Range / Focus Ordinal Bar Chart</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../css/dc.css"/>
</head>
<body>

<div class="container">
<script type="text/javascript" src="header.js"></script>
<div id="focus"></div>
<div id="range"></div>

    <script type="text/javascript" src="../js/promise-polyfill.js"></script>
    <script type="text/javascript" src="../js/fetch.umd.js"></script>
<script type="text/javascript" src="../js/d3.js"></script>
<script type="text/javascript" src="../js/crossfilter.js"></script>
<script type="text/javascript" src="../js/dc.js"></script>
  <style>
  #focus .axis.x .tick text {
    text-anchor: end;
    transform: rotate(-90deg) translate(-10px,-12px);
  }
  #range.dc-chart .axis {
    display: none;
  }
  </style>
<script type="text/javascript">
    dc.constants.EVENT_DELAY = 10;
    // phrases generated with https://www.fourmilab.ch/javascrypt/pass_phrase.html
    var focus, range;
    d3.json("wide-ordinal.json").then(function(wide) {
        // map ordinals to integers so that zooming will work
        var ord2int = {}, int2ord = [];
        wide.forEach(function(d, i) {
            ord2int[d.key] = i;
            int2ord[i] = d.key;
        });

        // dummy crossfilter taking group data and regrouping it to the same thing
        var cf = crossfilter(wide),
            dimension = cf.dimension(function(d) {return d.key;}),
            group = dimension.group().reduceSum(function(d) {return d.value;});

        focus = dc.barChart('#focus');
        focus
            .width(1000).height(350)
            .margins({left: 40, top: 10, right: 10, bottom: 175})
            .x(d3.scaleLinear().domain([0, int2ord.length+1]))
            .xUnits(dc.units.integers)
            .keyAccessor(kv => ord2int[kv.key])
            .centerBar(true)
            .yAxisLabel('counts')
            .elasticY(true)
            .brushOn(false)
            .dimension(dimension)
            .mouseZoomable(true)
            .zoomScale([4,8])
            .group(group)
            .title(kv => kv.key)
            .transitionDuration(0);

        focus.xAxis()
            .tickValues(d3.range(int2ord.length))
            .tickFormat(function(d) { return int2ord[d]; });

        range = dc.barChart('#range');
        range
            .margins({left: 0, top: 0, right: 0, bottom: 0})
            .width(1000).height(50)
            .x(d3.scaleLinear().domain([0, int2ord.length+1]))
            .xUnits(dc.units.integers)
            .keyAccessor(kv => ord2int[kv.key])
            .elasticY(true)
            .brushOn(true)
            .dimension(dimension)
            .group(group)
            .transitionDuration(0);

        focus
            .rangeChart(range)

        dc.renderAll();
        focus
            .focus([0,60])

    });

</script>

</div>
</body>
</html>
