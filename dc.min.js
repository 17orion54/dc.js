<<<<<<< HEAD
dc={version:"1.5.0",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10},_renderlet:null};dc.chartRegistry=function(){var _chartMap={};this.has=function(chart){for(var e in _chartMap){if(_chartMap[e].indexOf(chart)>=0)return true}return false};function initializeChartGroup(group){if(!group)group=dc.constants.DEFAULT_CHART_GROUP;if(!_chartMap[group])_chartMap[group]=[];return group}this.register=function(chart,group){group=initializeChartGroup(group);_chartMap[group].push(chart)};this.clear=function(){_chartMap={}};this.list=function(group){group=initializeChartGroup(group);return _chartMap[group]};return this}();dc.registerChart=function(chart,group){dc.chartRegistry.register(chart,group)};dc.hasChart=function(chart){return dc.chartRegistry.has(chart)};dc.deregisterAllCharts=function(){dc.chartRegistry.clear()};dc.filterAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].filterAll()}};dc.renderAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].render()}if(dc._renderlet!==null)dc._renderlet(group)};dc.redrawAll=function(group){var charts=dc.chartRegistry.list(group);for(var i=0;i<charts.length;++i){charts[i].redraw()}if(dc._renderlet!==null)dc._renderlet(group)};dc.transition=function(selections,duration,callback){if(duration<=0||duration===undefined)return selections;var s=selections.transition().duration(duration);if(callback instanceof Function){callback(s)}return s};dc.units={};dc.units.integers=function(s,e){return Math.abs(e-s)};dc.units.ordinal=function(s,e,domain){return domain};dc.units.fp={};dc.units.fp.precision=function(precision){var _f=function(s,e,domain){return Math.ceil(Math.abs((e-s)/_f.resolution))};_f.resolution=precision;return _f};dc.round={};dc.round.floor=function(n){return Math.floor(n)};dc.round.ceil=function(n){return Math.ceil(n)};dc.round.round=function(n){return Math.round(n)};dc.override=function(obj,functionName,newFunction){var existingFunction=obj[functionName];obj["_"+functionName]=existingFunction;obj[functionName]=newFunction};dc.renderlet=function(_){if(!arguments.length)return dc._renderlet;dc._renderlet=_;return dc};dc.instanceOfChart=function(o){return o instanceof Object&&o.__dc_flag__};dc.errors={};dc.errors.Exception=function(msg){var _msg=msg!=null?msg:"Unexpected internal error";this.message=_msg;this.toString=function(){return _msg}};dc.errors.InvalidStateException=function(){dc.errors.Exception.apply(this,arguments)};dc.dateFormat=d3.time.format("%m/%d/%Y");dc.printers={};dc.printers.filters=function(filters){var s="";for(var i=0;i<filters.length;++i){if(i>0)s+=", ";s+=dc.printers.filter(filters[i])}return s};dc.printers.filter=function(filter){var s="";if(filter){if(filter instanceof Array){if(filter.length>=2)s="["+dc.utils.printSingleValue(filter[0])+" -> "+dc.utils.printSingleValue(filter[1])+"]";else if(filter.length>=1)s=dc.utils.printSingleValue(filter[0])}else{s=dc.utils.printSingleValue(filter)}}return s};dc.utils={};dc.utils.printSingleValue=function(filter){var s=""+filter;if(filter instanceof Date)s=dc.dateFormat(filter);else if(typeof filter=="string")s=filter;else if(typeof filter=="number")s=Math.round(filter);return s};dc.utils.add=function(l,r){if(typeof r==="string")r=r.replace("%","");if(l instanceof Date){if(typeof r==="string")r=+r;var d=new Date;d.setTime(l.getTime());d.setDate(l.getDate()+r);return d}else if(typeof r==="string"){var percentage=+r/100;return l>0?l*(1+percentage):l*(1-percentage)}else{return l+r}};dc.utils.subtract=function(l,r){if(typeof r==="string")r=r.replace("%","");if(l instanceof Date){if(typeof r==="string")r=+r;var d=new Date;d.setTime(l.getTime());d.setDate(l.getDate()-r);return d}else if(typeof r==="string"){var percentage=+r/100;return l<0?l*(1+percentage):l*(1-percentage)}else{return l-r}};dc.utils.GroupStack=function(){var _dataLayers=[];var _groups=[];var _defaultAccessor;function initializeDataLayer(i){if(!_dataLayers[i])_dataLayers[i]=[]}this.setDataPoint=function(layerIndex,pointIndex,data){initializeDataLayer(layerIndex);_dataLayers[layerIndex][pointIndex]=data};this.getDataPoint=function(x,y){initializeDataLayer(x);var dataPoint=_dataLayers[x][y];if(dataPoint==undefined)dataPoint=0;return dataPoint};this.addGroup=function(group,accessor){if(!accessor)accessor=_defaultAccessor;_groups.push([group,accessor]);return _groups.length-1};this.getGroupByIndex=function(index){return _groups[index][0]};this.getAccessorByIndex=function(index){return _groups[index][1]};this.size=function(){return _groups.length};this.clear=function(){_dataLayers=[];_groups=[]};this.setDefaultAccessor=function(retriever){_defaultAccessor=retriever};this.getDataLayers=function(){return _dataLayers};this.toLayers=function(){var layers=[];for(var i=0;i<_dataLayers.length;++i){var layer={index:i,points:[]};var dataPoints=_dataLayers[i];for(var j=0;j<dataPoints.length;++j)layer.points.push(dataPoints[j]);layers.push(layer)}return layers}};dc.utils.isNegligible=function(max){return max===undefined||max<dc.constants.NEGLIGIBLE_NUMBER&&max>-dc.constants.NEGLIGIBLE_NUMBER};dc.utils.groupMax=function(group,accessor){var max=d3.max(group.all(),function(e){return accessor(e)});if(dc.utils.isNegligible(max))max=0;return max};dc.utils.groupMin=function(group,accessor){var min=d3.min(group.all(),function(e){return accessor(e)});if(dc.utils.isNegligible(min))min=0;return min};dc.utils.nameToId=function(name){return name.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")};dc.utils.appendOrSelect=function(parent,name){var element=parent.select(name);if(element.empty())element=parent.append(name);return element};dc.events={current:null};dc.events.trigger=function(closure,delay){if(!delay){closure();return}dc.events.current=closure;setTimeout(function(){if(closure==dc.events.current)closure()},delay)};dc.cumulative={};dc.cumulative.Base=function(){this._keyIndex=[];this._map={};this.sanitizeKey=function(key){key=key+"";return key};this.clear=function(){this._keyIndex=[];this._map={}};this.size=function(){return this._keyIndex.length};this.getValueByKey=function(key){key=this.sanitizeKey(key);var value=this._map[key];return value};this.setValueByKey=function(key,value){key=this.sanitizeKey(key);return this._map[key]=value};this.indexOfKey=function(key){key=this.sanitizeKey(key);return this._keyIndex.indexOf(key)};this.addToIndex=function(key){key=this.sanitizeKey(key);this._keyIndex.push(key)};this.getKeyByIndex=function(index){return this._keyIndex[index]}};dc.cumulative.Sum=function(){dc.cumulative.Base.apply(this,arguments);this.add=function(key,value){if(value==null)value=0;if(this.getValueByKey(key)==null){this.addToIndex(key);this.setValueByKey(key,value)}else{this.setValueByKey(key,this.getValueByKey(key)+value)}};this.minus=function(key,value){this.setValueByKey(key,this.getValueByKey(key)-value)};this.cumulativeSum=function(key){var keyIndex=this.indexOfKey(key);if(keyIndex<0)return 0;var cumulativeValue=0;for(var i=0;i<=keyIndex;++i){var k=this.getKeyByIndex(i);cumulativeValue+=this.getValueByKey(k)}return cumulativeValue}};dc.cumulative.Sum.prototype=new dc.cumulative.Base;dc.cumulative.CountUnique=function(){dc.cumulative.Base.apply(this,arguments);function hashSize(hash){var size=0,key;for(key in hash){if(hash.hasOwnProperty(key))size++}return size}this.add=function(key,e){if(this.getValueByKey(key)==null){this.setValueByKey(key,{});this.addToIndex(key)}if(e!=null){if(this.getValueByKey(key)[e]==null)this.getValueByKey(key)[e]=0;this.getValueByKey(key)[e]+=1}};this.minus=function(key,e){this.getValueByKey(key)[e]-=1;if(this.getValueByKey(key)[e]<=0)delete this.getValueByKey(key)[e]};this.count=function(key){return hashSize(this.getValueByKey(key))};this.cumulativeCount=function(key){var keyIndex=this.indexOfKey(key);if(keyIndex<0)return 0;var cumulativeCount=0;for(var i=0;i<=keyIndex;++i){var k=this.getKeyByIndex(i);cumulativeCount+=this.count(k)}return cumulativeCount}};dc.cumulative.CountUnique.prototype=new dc.cumulative.Base;dc.baseChart=function(_chart){_chart.__dc_flag__=true;var _dimension;var _group;var _anchor;var _root;var _svg;var _width=200,_height=200;var _keyAccessor=function(d){return d.key};var _valueAccessor=function(d){return d.value};var _ordering=function(p){return p.key};var _label=function(d){return d.key};var _renderLabel=false;var _title=function(d){return d.key+": "+d.value};var _renderTitle=false;var _transitionDuration=750;var _filterPrinter=dc.printers.filters;var _renderlets=[];var _chartGroup=dc.constants.DEFAULT_CHART_GROUP;var NULL_LISTENER=function(chart){};var _listeners={preRender:NULL_LISTENER,postRender:NULL_LISTENER,preRedraw:NULL_LISTENER,postRedraw:NULL_LISTENER,filtered:NULL_LISTENER,zoomed:NULL_LISTENER};var _filters=[];var _filterHandler=function(dimension,filters){dimension.filter(null);if(filters.length==0)dimension.filter(null);else if(filters.length==1)dimension.filter(filters[0]);else dimension.filterFunction(function(d){return filters.indexOf(d)>=0});return filters};_chart.width=function(w){if(!arguments.length)return _width;_width=w;return _chart};_chart.height=function(h){if(!arguments.length)return _height;_height=h;return _chart};_chart.dimension=function(d){if(!arguments.length)return _dimension;_dimension=d;_chart.expireCache();return _chart};_chart.group=function(g){if(!arguments.length)return _group;_group=g;_chart.expireCache();return _chart};_chart.ordering=function(o){if(!arguments.length)return _ordering;_ordering=o;_chart.expireCache();return _chart};_chart.filterAll=function(){return _chart.filter(null)};_chart.dataSet=function(){return _dimension!=undefined&&_group!=undefined};_chart.select=function(s){return _root.select(s)};_chart.selectAll=function(s){return _root?_root.selectAll(s):null};_chart.anchor=function(a,chartGroup){if(!arguments.length)return _anchor;if(dc.instanceOfChart(a)){_anchor=a.anchor();_root=a.root()}else{_anchor=a;_root=d3.select(_anchor);_root.classed(dc.constants.CHART_CLASS,true);dc.registerChart(_chart,chartGroup)}_chartGroup=chartGroup;return _chart};_chart.anchorName=function(){var anchor=this.anchor();return _.isObject(anchor)?anchor.id:_chart.anchor().replace("#","")};_chart.root=function(r){if(!arguments.length)return _root;_root=r;return _chart};_chart.svg=function(_){if(!arguments.length)return _svg;_svg=_;return _chart};_chart.resetSvg=function(){_chart.select("svg").remove();return _chart.generateSvg()};_chart.generateSvg=function(){_svg=_chart.root().append("svg").attr("width",_chart.width()).attr("height",_chart.height());return _svg};_chart.filterPrinter=function(_){if(!arguments.length)return _filterPrinter;_filterPrinter=_;return _chart};_chart.turnOnControls=function(){if(_root){_chart.selectAll(".reset").style("display",null);_chart.selectAll(".filter").text(_filterPrinter(_chart.filters())).style("display",null)}return _chart};_chart.turnOffControls=function(){if(_root){_chart.selectAll(".reset").style("display","none");_chart.selectAll(".filter").style("display","none").text(_chart.filter())}return _chart};_chart.transitionDuration=function(d){if(!arguments.length)return _transitionDuration;_transitionDuration=d;return _chart};_chart.render=function(){_listeners.preRender(_chart);if(_dimension==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.dimension is missing on chart[#"+_chart.anchorName()+"]");if(_group==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.group is missing on chart[#"+_chart.anchorName()+"]");var result=_chart.doRender();_chart.activateRenderlets("postRender");return result};_chart.activateRenderlets=function(event){if(_chart.transitionDuration()>0&&_svg){_svg.transition().duration(_chart.transitionDuration()).each("end",function(){runAllRenderlets();if(event)_listeners[event](_chart)})}else{runAllRenderlets();if(event)_listeners[event](_chart)}};_chart.redraw=function(){_listeners.preRedraw(_chart);var result=_chart.doRedraw();_chart.activateRenderlets("postRedraw");return result};_chart.invokeFilteredListener=function(chart,f){if(f!==undefined)_listeners.filtered(_chart,f)};_chart.invokeZoomedListener=function(chart){_listeners.zoomed(_chart)};_chart.hasFilter=function(filter){if(!arguments.length)return _filters.length>0;return _filters.indexOf(filter)>=0};function removeFilter(_){_filters.splice(_filters.indexOf(_),1);applyFilters();_chart.invokeFilteredListener(_chart,_)}function addFilter(_){_filters.push(_);applyFilters();_chart.invokeFilteredListener(_chart,_)}function resetFilters(){_filters=[];applyFilters();_chart.invokeFilteredListener(_chart,null)}function applyFilters(){if(_chart.dataSet()&&_chart.dimension().filter!=undefined){var fs=_filterHandler(_chart.dimension(),_filters);_filters=fs?fs:_filters}}_chart.filter=function(_){if(!arguments.length)return _filters.length>0?_filters[0]:null;if(_==null){resetFilters()}else{if(_chart.hasFilter(_))removeFilter(_);else addFilter(_)}if(_root!=null&&_chart.hasFilter()){_chart.turnOnControls()}else{_chart.turnOffControls()}return _chart};_chart.filters=function(){return _filters};_chart.highlightSelected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,true);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false)};_chart.fadeDeselected=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,true)};_chart.resetHighlight=function(e){d3.select(e).classed(dc.constants.SELECTED_CLASS,false);d3.select(e).classed(dc.constants.DESELECTED_CLASS,false)};_chart.onClick=function(d){var filter=_chart.keyAccessor()(d);dc.events.trigger(function(){_chart.filter(filter);dc.redrawAll(_chart.chartGroup())})};_chart.filterHandler=function(_){if(!arguments.length)return _filterHandler;_filterHandler=_;return _chart};_chart.doRender=function(){return _chart};_chart.doRedraw=function(){return _chart};_chart.keyAccessor=function(_){if(!arguments.length)return _keyAccessor;_keyAccessor=_;return _chart};_chart.valueAccessor=function(_){if(!arguments.length)return _valueAccessor;_valueAccessor=_;return _chart};_chart.label=function(_){if(!arguments.length)return _label;_label=_;_renderLabel=true;return _chart};_chart.renderLabel=function(_){if(!arguments.length)return _renderLabel;_renderLabel=_;return _chart};_chart.title=function(_){if(!arguments.length)return _title;_title=_;_renderTitle=true;return _chart};_chart.renderTitle=function(_){if(!arguments.length)return _renderTitle;_renderTitle=_;return _chart};_chart.renderlet=function(_){_renderlets.push(_);return _chart};function runAllRenderlets(){for(var i=0;i<_renderlets.length;++i){_renderlets[i](_chart)}}_chart.chartGroup=function(_){if(!arguments.length)return _chartGroup;_chartGroup=_;return _chart};_chart.on=function(event,listener){_listeners[event]=listener;return _chart};_chart.expireCache=function(){return _chart};return _chart};dc.marginable=function(_chart){var _margin={top:10,right:50,bottom:30,left:30};_chart.margins=function(m){if(!arguments.length)return _margin;_margin=m;return _chart};_chart.effectiveWidth=function(){return _chart.width()-_chart.margins().left-_chart.margins().right};_chart.effectiveHeight=function(){return _chart.height()-_chart.margins().top-_chart.margins().bottom};return _chart};dc.coordinateGridChart=function(_chart){var DEFAULT_Y_AXIS_TICKS=5;var GRID_LINE_CLASS="grid-line";var HORIZONTAL_CLASS="horizontal";var VERTICAL_CLASS="vertical";_chart=dc.colorChart(dc.marginable(dc.baseChart(_chart)));_chart.colors(d3.scale.category10());var _parent;var _g;var _chartBodyG;var _x;var _xOriginalDomain;var _xAxis=d3.svg.axis();var _xUnits=dc.units.integers;var _xAxisPadding=0;var _xElasticity=false;var _y;var _yAxis=d3.svg.axis();var _yAxisPadding=0;var _yElasticity=false;var _brush=d3.svg.brush();var _brushOn=true;var _round;var _renderHorizontalGridLine=false;var _renderVerticalGridLine=false;var _refocused=false;var _unitCount;var _rangeChart;var _focusChart;var _mouseZoomable=false;var _clipPadding=0;_chart.title(function(d){return d.data.key+": "+d.data.value});_chart.rescale=function(){_unitCount=null;_chart.xUnitCount()};_chart.rangeChart=function(_){if(!arguments.length)return _rangeChart;_rangeChart=_;_rangeChart.focusChart(_chart);return _chart};_chart.generateG=function(parent){if(parent==null)_parent=_chart.svg();else _parent=parent;_g=_parent.append("g");_chartBodyG=_g.append("g").attr("class","chartBody").attr("transform","translate("+_chart.margins().left+", "+_chart.margins().top+")").attr("clip-path","url(#"+getClipPathId()+")");return _g};_chart.g=function(_){if(!arguments.length)return _g;_g=_;return _chart};_chart.mouseZoomable=function(z){if(!arguments.length)return _mouseZoomable;_mouseZoomable=z;return _chart};_chart.chartBodyG=function(_){if(!arguments.length)return _chartBodyG;_chartBodyG=_;return _chart};_chart.x=function(_){if(!arguments.length)return _x;_x=_;_xOriginalDomain=_x.domain();return _chart};_chart.xOriginalDomain=function(){return _xOriginalDomain};_chart.xUnits=function(_){if(!arguments.length)return _xUnits;_xUnits=_;return _chart};_chart.xAxis=function(_){if(!arguments.length)return _xAxis;_xAxis=_;return _chart};_chart.elasticX=function(_){if(!arguments.length)return _xElasticity;_xElasticity=_;return _chart};_chart.xAxisPadding=function(_){if(!arguments.length)return _xAxisPadding;_xAxisPadding=_;return _chart};_chart.xUnitCount=function(){if(_unitCount==null){var units=_chart.xUnits()(_chart.x().domain()[0],_chart.x().domain()[1],_chart.x().domain());if(units instanceof Array)_unitCount=units.length;else _unitCount=units}return _unitCount};_chart.isOrdinal=function(){return _chart.xUnits()===dc.units.ordinal};_chart.prepareOrdinalXAxis=function(count){if(!count)count=_chart.xUnitCount();var range=[];var currentPosition=0;var increment=_chart.xAxisLength()/count;for(var i=0;i<count;i++){range[i]=currentPosition;currentPosition+=increment}_x.range(range)};function prepareXAxis(g){if(_chart.elasticX()&&!_chart.isOrdinal()){_x.domain([_chart.xAxisMin(),_chart.xAxisMax()])}if(_chart.isOrdinal()){_chart.prepareOrdinalXAxis()}else{_x.range([0,_chart.xAxisLength()])}_xAxis=_xAxis.scale(_chart.x()).orient("bottom");renderVerticalGridLines(g)}_chart.renderXAxis=function(g){var axisXG=g.selectAll("g.x");if(axisXG.empty())axisXG=g.append("g").attr("class","axis x").attr("transform","translate("+_chart.margins().left+","+_chart.xAxisY()+")");dc.transition(axisXG,_chart.transitionDuration()).call(_xAxis)};function renderVerticalGridLines(g){var gridLineG=g.selectAll("g."+VERTICAL_CLASS);if(_renderVerticalGridLine){if(gridLineG.empty())gridLineG=g.insert("g",":first-child").attr("class",GRID_LINE_CLASS+" "+VERTICAL_CLASS).attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");var ticks=_xAxis.tickValues()?_xAxis.tickValues():_x.ticks(_xAxis.ticks()[0]);var lines=gridLineG.selectAll("line").data(ticks);var linesGEnter=lines.enter().append("line").attr("x1",function(d){return _x(d)}).attr("y1",_chart.xAxisY()-_chart.margins().top).attr("x2",function(d){return _x(d)}).attr("y2",0).attr("opacity",0);dc.transition(linesGEnter,_chart.transitionDuration()).attr("opacity",1);dc.transition(lines,_chart.transitionDuration()).attr("x1",function(d){return _x(d)}).attr("y1",_chart.xAxisY()-_chart.margins().top).attr("x2",function(d){return _x(d)}).attr("y2",0);lines.exit().remove()}else{gridLineG.selectAll("line").remove()}}_chart.xAxisY=function(){return _chart.height()-_chart.margins().bottom};_chart.xAxisLength=function(){return _chart.effectiveWidth()};function prepareYAxis(g){if(_y==null||_chart.elasticY()){_y=d3.scale.linear();_y.domain([_chart.yAxisMin(),_chart.yAxisMax()]).rangeRound([_chart.yAxisHeight(),0])}_y.range([_chart.yAxisHeight(),0]);_yAxis=_yAxis.scale(_y).orient("left").ticks(DEFAULT_Y_AXIS_TICKS);renderHorizontalGridLines(g)}_chart.renderYAxis=function(g){var axisYG=g.selectAll("g.y");if(axisYG.empty())axisYG=g.append("g").attr("class","axis y").attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");dc.transition(axisYG,_chart.transitionDuration()).call(_yAxis)};function renderHorizontalGridLines(g){var gridLineG=g.selectAll("g."+HORIZONTAL_CLASS);if(_renderHorizontalGridLine){var ticks=_yAxis.tickValues()?_yAxis.tickValues():_y.ticks(_yAxis.ticks()[0]);if(gridLineG.empty())gridLineG=g.insert("g",":first-child").attr("class",GRID_LINE_CLASS+" "+HORIZONTAL_CLASS).attr("transform","translate("+_chart.yAxisX()+","+_chart.margins().top+")");var lines=gridLineG.selectAll("line").data(ticks);var linesGEnter=lines.enter().append("line").attr("x1",1).attr("y1",function(d){return _y(d)}).attr("x2",_chart.xAxisLength()).attr("y2",function(d){return _y(d)}).attr("opacity",0);dc.transition(linesGEnter,_chart.transitionDuration()).attr("opacity",1);dc.transition(lines,_chart.transitionDuration()).attr("x1",1).attr("y1",function(d){return _y(d)}).attr("x2",_chart.xAxisLength()).attr("y2",function(d){return _y(d)});lines.exit().remove()}else{gridLineG.selectAll("line").remove()}}_chart.yAxisX=function(){return _chart.margins().left};_chart.y=function(_){if(!arguments.length)return _y;_y=_;return _chart};_chart.yAxis=function(y){if(!arguments.length)return _yAxis;_yAxis=y;return _chart};_chart.elasticY=function(_){if(!arguments.length)return _yElasticity;_yElasticity=_;return _chart};_chart.renderHorizontalGridLines=function(_){if(!arguments.length)return _renderHorizontalGridLine;_renderHorizontalGridLine=_;return _chart};_chart.renderVerticalGridLines=function(_){if(!arguments.length)return _renderVerticalGridLine;_renderVerticalGridLine=_;return _chart};_chart.xAxisMin=function(){var min=d3.min(_chart.group().all(),function(e){return _chart.keyAccessor()(e)});return dc.utils.subtract(min,_xAxisPadding)};_chart.xAxisMax=function(){var max=d3.max(_chart.group().all(),function(e){return _chart.keyAccessor()(e)});return dc.utils.add(max,_xAxisPadding)};_chart.yAxisMin=function(){var min=d3.min(_chart.group().all(),function(e){return _chart.valueAccessor()(e)});min=dc.utils.subtract(min,_yAxisPadding);return min};_chart.yAxisMax=function(){var max=d3.max(_chart.group().all(),function(e){return _chart.valueAccessor()(e)});max=dc.utils.add(max,_yAxisPadding);return max};_chart.yAxisPadding=function(_){if(!arguments.length)return _yAxisPadding;_yAxisPadding=_;return _chart};_chart.yAxisHeight=function(){return _chart.effectiveHeight()};_chart.round=function(_){if(!arguments.length)return _round;_round=_;return _chart};dc.override(_chart,"filter",function(_){if(!arguments.length)return _chart._filter();_chart._filter(_);if(_){_chart.brush().extent(_)}else{_chart.brush().clear()}return _chart});_chart.brush=function(_){if(!arguments.length)return _brush;_brush=_;return _chart};function brushHeight(){return _chart.xAxisY()-_chart.margins().top}_chart.renderBrush=function(g){if(_chart.isOrdinal())_brushOn=false;if(_brushOn){_brush.on("brushstart",brushStart).on("brush",brushing).on("brushend",brushEnd);var gBrush=g.append("g").attr("class","brush").attr("transform","translate("+_chart.margins().left+","+_chart.margins().top+")").call(_brush.x(_chart.x()));gBrush.selectAll("rect").attr("height",brushHeight());gBrush.selectAll(".resize").append("path").attr("d",_chart.resizeHandlePath);if(_chart.hasFilter()){_chart.redrawBrush(g)}}};function brushStart(p){}_chart.extendBrush=function(){var extent=_brush.extent();if(_chart.round()){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_g.select(".brush").call(_brush.extent(extent))}return extent};_chart.brushIsEmpty=function(extent){return _brush.empty()||!extent||extent[1]<=extent[0]};function brushing(p){var extent=_chart.extendBrush();_chart.redrawBrush(_g);if(_chart.brushIsEmpty(extent)){dc.events.trigger(function(){_chart.filter(null);dc.redrawAll(_chart.chartGroup())})}else{dc.events.trigger(function(){_chart.filter(null);_chart.filter([extent[0],extent[1]]);dc.redrawAll(_chart.chartGroup())},dc.constants.EVENT_DELAY)}}function brushEnd(p){}_chart.redrawBrush=function(g){if(_brushOn){if(_chart.filter()&&_chart.brush().empty())_chart.brush().extent(_chart.filter());var gBrush=g.select("g.brush");gBrush.call(_chart.brush().x(_chart.x()));gBrush.selectAll("rect").attr("height",brushHeight())}_chart.fadeDeselectedArea()};_chart.fadeDeselectedArea=function(){};_chart.resizeHandlePath=function(d){var e=+(d=="e"),x=e?1:-1,y=brushHeight()/3;return"M"+.5*x+","+y+"A6,6 0 0 "+e+" "+6.5*x+","+(y+6)+"V"+(2*y-6)+"A6,6 0 0 "+e+" "+.5*x+","+2*y+"Z"+"M"+2.5*x+","+(y+8)+"V"+(2*y-8)+"M"+4.5*x+","+(y+8)+"V"+(2*y-8)};function getClipPathId(){return _chart.anchorName()+"-clip"}_chart.clipPadding=function(p){if(!arguments.length)return _clipPadding;_clipPadding=p;return _chart};function generateClipPath(){var defs=dc.utils.appendOrSelect(_parent,"defs");var chartBodyClip=dc.utils.appendOrSelect(defs,"clipPath").attr("id",getClipPathId());var padding=_clipPadding*2;dc.utils.appendOrSelect(chartBodyClip,"rect").attr("width",_chart.xAxisLength()+padding).attr("height",_chart.yAxisHeight()+padding)}_chart.doRender=function(){if(_x==null)throw new dc.errors.InvalidStateException("Mandatory attribute chart.x is missing on chart[#"+_chart.anchorName()+"]");_chart.resetSvg();if(_chart.dataSet()){_chart.generateG();generateClipPath();prepareXAxis(_chart.g());prepareYAxis(_chart.g());_chart.plotData();_chart.renderXAxis(_chart.g());_chart.renderYAxis(_chart.g());_chart.renderBrush(_chart.g());enableMouseZoom()}return _chart};function enableMouseZoom(){if(_mouseZoomable){_chart.root().call(d3.behavior.zoom().x(_chart.x()).scaleExtent([1,100]).on("zoom",function(){_chart.focus(_chart.x().domain());_chart.invokeZoomedListener(_chart);updateRangeSelChart()}))}}function updateRangeSelChart(){if(_rangeChart){var refDom=_chart.x().domain();var origDom=_rangeChart.xOriginalDomain();var newDom=[refDom[0]<origDom[0]?refDom[0]:origDom[0],refDom[1]>origDom[1]?refDom[1]:origDom[1]];_rangeChart.focus(newDom);_rangeChart.filter(null);_rangeChart.filter(refDom);dc.events.trigger(function(){dc.redrawAll(_chart.chartGroup())})}}_chart.doRedraw=function(){prepareXAxis(_chart.g());prepareYAxis(_chart.g());_chart.plotData();if(_chart.elasticY())_chart.renderYAxis(_chart.g());if(_chart.elasticX()||_refocused)_chart.renderXAxis(_chart.g());_chart.redrawBrush(_chart.g());return _chart};_chart.subRender=function(){if(_chart.dataSet()){_chart.plotData()}return _chart};_chart.brushOn=function(_){if(!arguments.length)return _brushOn;_brushOn=_;return _chart};_chart.getDataWithinXDomain=function(group){var data=[];if(_chart.isOrdinal()){data=group.all()}else{group.all().forEach(function(d){var key=_chart.keyAccessor()(d);if(key>=_chart.x().domain()[0]&&key<=_chart.x().domain()[1])data.push(d)})}return data};function hasRangeSelected(range){return range instanceof Array&&range.length>1}_chart.focus=function(range){_refocused=true;if(hasRangeSelected(range)){_chart.x().domain(range)}else{_chart.x().domain(_chart.xOriginalDomain())}_chart.rescale();_chart.redraw();if(!hasRangeSelected(range))_refocused=false};_chart.refocused=function(){return _refocused};_chart.focusChart=function(c){if(!arguments.length)return _focusChart;_focusChart=c;_chart.on("filtered",function(chart){dc.events.trigger(function(){_focusChart.focus(chart.filter());_focusChart.filter(chart.filter());dc.redrawAll(chart.chartGroup())})});return _chart};return _chart};dc.colorChart=function(_chart){var _colors=d3.scale.category20c();var _colorDomain=[0,_colors.range().length];var _colorCalculator=function(value){var minValue=_colorDomain[0];var maxValue=_colorDomain[1];if(isNaN(value))value=0;if(maxValue==null)return _colors(value);var colorsLength=_chart.colors().range().length;var denominator=(maxValue-minValue)/colorsLength;var colorValue=Math.abs(Math.min(colorsLength-1,Math.round((value-minValue)/denominator)));return _chart.colors()(colorValue)};var _colorAccessor=function(d,i){return i};_chart.colors=function(_){if(!arguments.length)return _colors;if(_ instanceof Array){_colors=d3.scale.ordinal().range(_);var domain=[];for(var i=0;i<_.length;++i){domain.push(i)}_colors.domain(domain)}else{_colors=_}_colorDomain=[0,_colors.range().length];return _chart};_chart.colorCalculator=function(_){if(!arguments.length)return _colorCalculator;_colorCalculator=_;return _chart};_chart.getColor=function(d,i){return _colorCalculator(_colorAccessor(d,i))};_chart.colorAccessor=function(_){if(!arguments.length)return _colorAccessor;_colorAccessor=_;return _chart};_chart.colorDomain=function(_){if(!arguments.length)return _colorDomain;_colorDomain=_;return _chart};return _chart};dc.stackableChart=function(_chart){var _groupStack=new dc.utils.GroupStack;var _stackLayout=d3.layout.stack().offset("zero").order("default").values(function(d){return d.points});var _allGroups;var _allValueAccessors;var _allKeyAccessors;var _stackLayers;_chart.stack=function(group,retriever){_groupStack.setDefaultAccessor(_chart.valueAccessor());_groupStack.addGroup(group,retriever);_chart.expireCache();return _chart};_chart.expireCache=function(){_allGroups=null;_allValueAccessors=null;_allKeyAccessors=null;_stackLayers=null;return _chart};_chart.allGroups=function(){if(_allGroups==null){_allGroups=[];_allGroups.push(_chart.group());for(var i=0;i<_groupStack.size();++i)_allGroups.push(_groupStack.getGroupByIndex(i))}return _allGroups};_chart.allValueAccessors=function(){if(_allValueAccessors==null){_allValueAccessors=[];_allValueAccessors.push(_chart.valueAccessor());for(var i=0;i<_groupStack.size();++i)_allValueAccessors.push(_groupStack.getAccessorByIndex(i))}return _allValueAccessors};_chart.getValueAccessorByIndex=function(groupIndex){return _chart.allValueAccessors()[groupIndex]};_chart.yAxisMin=function(){var min,all=flattenStack();min=d3.min(all,function(p){return p.y+p.y0<p.y0?p.y+p.y0:p.y0});min=dc.utils.subtract(min,_chart.yAxisPadding());return min};_chart.yAxisMax=function(){var max,all=flattenStack();max=d3.max(all,function(p){return p.y+p.y0});max=dc.utils.add(max,_chart.yAxisPadding());return max};function flattenStack(){var all=[];if(_chart.x()){var xDomain=_chart.x().domain();_chart.stackLayers().forEach(function(e){e.points.forEach(function(p){if(p.x>=xDomain[0]&&p.x<=xDomain[1])all.push(p)})})}else{_chart.stackLayers().forEach(function(e){all=all.concat(e.points)})}return all}_chart.allKeyAccessors=function(){if(_allKeyAccessors==null){_allKeyAccessors=[];_allKeyAccessors.push(_chart.keyAccessor());for(var i=0;i<_groupStack.size();++i)_allKeyAccessors.push(_chart.keyAccessor())}return _allKeyAccessors};_chart.getKeyAccessorByIndex=function(groupIndex){return _chart.allKeyAccessors()[groupIndex]};_chart.xAxisMin=function(){var min=null;var allGroups=_chart.allGroups();for(var groupIndex=0;groupIndex<allGroups.length;++groupIndex){var group=allGroups[groupIndex];var m=dc.utils.groupMin(group,_chart.getKeyAccessorByIndex(groupIndex));if(min==null||min>m)min=m}return dc.utils.subtract(min,_chart.xAxisPadding())};_chart.xAxisMax=function(){var max=null;var allGroups=_chart.allGroups();for(var groupIndex=0;groupIndex<allGroups.length;++groupIndex){var group=allGroups[groupIndex];var m=dc.utils.groupMax(group,_chart.getKeyAccessorByIndex(groupIndex));if(max==null||max<m)max=m}return dc.utils.add(max,_chart.xAxisPadding())};function getKeyFromData(groupIndex,d){return _chart.getKeyAccessorByIndex(groupIndex)(d)}function getValueFromData(groupIndex,d){return _chart.getValueAccessorByIndex(groupIndex)(d)}function calculateDataPointMatrix(data,groupIndex){for(var dataIndex=0;dataIndex<data.length;++dataIndex){var d=data[dataIndex];var key=getKeyFromData(groupIndex,d);var value=getValueFromData(groupIndex,d);
_groupStack.setDataPoint(groupIndex,dataIndex,{data:d,x:key,y:value})}}_chart.calculateDataPointMatrixForAll=function(){var groups=_chart.allGroups();for(var groupIndex=0;groupIndex<groups.length;++groupIndex){var group=groups[groupIndex];var data=group.all();calculateDataPointMatrix(data,groupIndex)}};_chart.getChartStack=function(){return _groupStack};dc.override(_chart,"valueAccessor",function(_){if(!arguments.length)return _chart._valueAccessor();_chart.expireCache();return _chart._valueAccessor(_)});dc.override(_chart,"keyAccessor",function(_){if(!arguments.length)return _chart._keyAccessor();_chart.expireCache();return _chart._keyAccessor(_)});_chart.stackLayout=function(stack){if(!arguments.length)return _stackLayout;_stackLayout=stack;return _chart};_chart.stackLayers=function(_){if(!arguments.length){if(_stackLayers==null){_chart.calculateDataPointMatrixForAll();_stackLayers=_chart.stackLayout()(_groupStack.toLayers())}return _stackLayers}else{_stackLayers=_}};return _chart};dc.abstractBubbleChart=function(_chart){var _maxBubbleRelativeSize=.3;var _minRadiusWithLabel=10;_chart.BUBBLE_NODE_CLASS="node";_chart.BUBBLE_CLASS="bubble";_chart.MIN_RADIUS=10;_chart=dc.colorChart(_chart);_chart.renderLabel(true);_chart.renderTitle(false);var _r=d3.scale.linear().domain([0,100]);var _rValueAccessor=function(d){return d.r};_chart.r=function(_){if(!arguments.length)return _r;_r=_;return _chart};_chart.radiusValueAccessor=function(_){if(!arguments.length)return _rValueAccessor;_rValueAccessor=_;return _chart};_chart.rMin=function(){var min=d3.min(_chart.group().all(),function(e){return _chart.radiusValueAccessor()(e)});return min};_chart.rMax=function(){var max=d3.max(_chart.group().all(),function(e){return _chart.radiusValueAccessor()(e)});return max};_chart.bubbleR=function(d){var value=_chart.radiusValueAccessor()(d);var r=_chart.r()(value);if(isNaN(r)||value<=0)r=0;return r};var labelFunction=function(d){return _chart.label()(d)};var labelOpacity=function(d){return _chart.bubbleR(d)>_minRadiusWithLabel?1:0};_chart.doRenderLabel=function(bubbleGEnter){if(_chart.renderLabel()){var label=bubbleGEnter.select("text");if(label.empty()){label=bubbleGEnter.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",_chart.onClick)}label.attr("opacity",0).text(labelFunction);dc.transition(label,_chart.transitionDuration()).attr("opacity",labelOpacity)}};_chart.doUpdateLabels=function(bubbleGEnter){if(_chart.renderLabel()){var labels=bubbleGEnter.selectAll("text").text(labelFunction);dc.transition(labels,_chart.transitionDuration()).attr("opacity",labelOpacity)}};var titleFunction=function(d){return _chart.title()(d)};_chart.doRenderTitles=function(g){if(_chart.renderTitle()){var title=g.select("title");if(title.empty())g.append("title").text(titleFunction)}};_chart.doUpdateTitles=function(g){if(_chart.renderTitle()){g.selectAll("title").text(titleFunction)}};_chart.minRadiusWithLabel=function(_){if(!arguments.length)return _minRadiusWithLabel;_minRadiusWithLabel=_;return _chart};_chart.maxBubbleRelativeSize=function(_){if(!arguments.length)return _maxBubbleRelativeSize;_maxBubbleRelativeSize=_;return _chart};_chart.initBubbleColor=function(d,i){this[dc.constants.NODE_INDEX_NAME]=i;return _chart.getColor(d,i)};_chart.updateBubbleColor=function(d,i){return _chart.getColor(d,this[dc.constants.NODE_INDEX_NAME])};_chart.fadeDeselectedArea=function(){if(_chart.hasFilter()){_chart.selectAll("g."+_chart.BUBBLE_NODE_CLASS).each(function(d){if(_chart.isSelectedNode(d)){_chart.highlightSelected(this)}else{_chart.fadeDeselected(this)}})}else{_chart.selectAll("g."+_chart.BUBBLE_NODE_CLASS).each(function(d){_chart.resetHighlight(this)})}};_chart.isSelectedNode=function(d){return _chart.hasFilter(d.key)};_chart.onClick=function(d){var filter=d.key;dc.events.trigger(function(){_chart.filter(filter);dc.redrawAll(_chart.chartGroup())})};return _chart};dc.pieChart=function(parent,chartGroup){var DEFAULT_MIN_ANGLE_FOR_LABEL=.5;var _sliceCssClass="pie-slice";var _radius,_innerRadius=0;var _g;var _minAngleForLabel=DEFAULT_MIN_ANGLE_FOR_LABEL;var _chart=dc.colorChart(dc.baseChart({}));var _slicesCap=Infinity;var _othersLabel="Others";var _othersGrouper=function(data,sum){data.push({key:_othersLabel,value:sum})};function assemblePieData(){if(_slicesCap==Infinity){var data=_chart.group().all().slice(0);if(data.length<2)return data;var compf=_.isNumber(_chart.ordering()(data[0]))?function(a,b){return _chart.ordering()(a)-_chart.ordering()(b)}:function(a,b){return _chart.ordering()(a).localeCompare(_chart.ordering()(b))};data.sort(compf);return data}else{var topRows=_chart.group().top(_slicesCap);var topRowsSum=d3.sum(topRows,_chart.valueAccessor());var allRows=_chart.group().all();var allRowsSum=d3.sum(allRows,_chart.valueAccessor());_othersGrouper(topRows,allRowsSum-topRowsSum);return topRows}}_chart.label(function(d){return _chart.keyAccessor()(d.data)});_chart.renderLabel(true);_chart.title(function(d){return _chart.keyAccessor()(d.data)+": "+_chart.valueAccessor()(d.data)});_chart.transitionDuration(350);_chart.doRender=function(){_chart.resetSvg();_g=_chart.svg().append("g").attr("transform","translate("+_chart.cx()+","+_chart.cy()+")");drawChart();return _chart};function drawChart(){if(_chart.dataSet()){var pie=calculateDataPie();_radius=_radius?_radius:d3.min([_chart.width(),_chart.height()])/2;var arc=_chart.buildArcs();var pieData=pie(assemblePieData());if(_g){var slices=_g.selectAll("g."+_sliceCssClass).data(pieData);createElements(slices,arc,pieData);updateElements(pieData,arc);removeElements(slices);highlightFilter()}}}function createElements(slices,arc,pieData){var slicesEnter=createSliceNodes(slices);createSlicePath(slicesEnter,arc);createTitles(slicesEnter);createLabels(pieData,arc)}function createSliceNodes(slices){var slicesEnter=slices.enter().append("g").attr("class",function(d,i){return _sliceCssClass+" _"+i});return slicesEnter}function createSlicePath(slicesEnter,arc){var slicePath=slicesEnter.append("path").attr("fill",function(d,i){return _chart.getColor(d,i)}).on("click",onClick).attr("d",function(d,i){return safeArc(d,i,arc)});slicePath.transition().duration(_chart.transitionDuration()).attrTween("d",tweenPie)}function createTitles(slicesEnter){if(_chart.renderTitle()){slicesEnter.append("title").text(function(d){return _chart.title()(d)})}}function createLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll("text."+_sliceCssClass).data(pieData);var labelsEnter=labels.enter().append("text").attr("class",function(d,i){return _sliceCssClass+" _"+i}).on("click",onClick);dc.transition(labelsEnter,_chart.transitionDuration()).attr("transform",function(d){d.innerRadius=_chart.innerRadius();d.outerRadius=_radius;var centroid=arc.centroid(d);if(isNaN(centroid[0])||isNaN(centroid[1])){return"translate(0,0)"}else{return"translate("+centroid+")"}}).attr("text-anchor","middle").text(function(d){var data=d.data;if(sliceHasNoData(data)||sliceTooSmall(d))return"";return _chart.label()(d)})}}function updateElements(pieData,arc){updateSlicePaths(pieData,arc);updateLabels(pieData,arc);updateTitles(pieData)}function updateSlicePaths(pieData,arc){var slicePaths=_g.selectAll("g."+_sliceCssClass).data(pieData).select("path").attr("d",function(d,i){return safeArc(d,i,arc)});dc.transition(slicePaths,_chart.transitionDuration(),function(s){s.attrTween("d",tweenPie)}).attr("fill",function(d,i){return _chart.getColor(d,i)})}function updateLabels(pieData,arc){if(_chart.renderLabel()){var labels=_g.selectAll("text."+_sliceCssClass).data(pieData);dc.transition(labels,_chart.transitionDuration()).attr("transform",function(d){d.innerRadius=_chart.innerRadius();d.outerRadius=_radius;var centroid=arc.centroid(d);if(isNaN(centroid[0])||isNaN(centroid[1])){return"translate(0,0)"}else{return"translate("+centroid+")"}}).attr("text-anchor","middle").text(function(d){var data=d.data;if(sliceHasNoData(data)||sliceTooSmall(d))return"";return _chart.label()(d)})}}function updateTitles(pieData){if(_chart.renderTitle()){_g.selectAll("g."+_sliceCssClass).data(pieData).select("title").text(function(d){return _chart.title()(d)})}}function removeElements(slices){slices.exit().remove()}function highlightFilter(){if(_chart.hasFilter()){_chart.selectAll("g."+_sliceCssClass).each(function(d){if(_chart.isSelectedSlice(d)){_chart.highlightSelected(this)}else{_chart.fadeDeselected(this)}})}else{_chart.selectAll("g."+_sliceCssClass).each(function(d){_chart.resetHighlight(this)})}}_chart.innerRadius=function(r){if(!arguments.length)return _innerRadius;_innerRadius=r;return _chart};_chart.radius=function(r){if(!arguments.length)return _radius;_radius=r;return _chart};_chart.cx=function(){return _chart.width()/2};_chart.cy=function(){return _chart.height()/2};_chart.buildArcs=function(){return d3.svg.arc().outerRadius(_radius).innerRadius(_innerRadius)};_chart.isSelectedSlice=function(d){return _chart.hasFilter(_chart.keyAccessor()(d.data))};_chart.doRedraw=function(){drawChart();return _chart};_chart.minAngleForLabel=function(_){if(!arguments.length)return _minAngleForLabel;_minAngleForLabel=_;return _chart};_chart.slicesCap=function(_){if(!arguments.length)return _slicesCap;_slicesCap=_;return _chart};_chart.othersLabel=function(_){if(!arguments.length)return _othersLabel;_othersLabel=_;return _chart};_chart.othersGrouper=function(_){if(!arguments.length)return _othersGrouper;_othersGrouper=_;return _chart};function calculateDataPie(){return d3.layout.pie().sort(null).value(function(d){return _chart.valueAccessor()(d)})}function sliceTooSmall(d){var angle=d.endAngle-d.startAngle;return isNaN(angle)||angle<_minAngleForLabel}function sliceHasNoData(data){return _chart.valueAccessor()(data)==0}function tweenPie(b){b.innerRadius=_chart.innerRadius();var current=this._current;if(isOffCanvas(current))current={startAngle:0,endAngle:0};var i=d3.interpolate(current,b);this._current=i(0);return function(t){return safeArc(i(t),0,_chart.buildArcs())}}function isOffCanvas(current){return current==null||isNaN(current.startAngle)||isNaN(current.endAngle)}function onClick(d){_chart.onClick(d.data)}function safeArc(d,i,arc){var path=arc(d,i);if(path.indexOf("NaN")>=0)path="M0,0";return path}return _chart.anchor(parent,chartGroup)};dc.barChart=function(parent,chartGroup){var MIN_BAR_WIDTH=1;var DEFAULT_GAP_BETWEEN_BARS=2;var _chart=dc.stackableChart(dc.coordinateGridChart({}));var _gap=DEFAULT_GAP_BETWEEN_BARS;var _centerBar=false;var _numberOfBars;var _barWidth;dc.override(_chart,"rescale",function(){_chart._rescale();_numberOfBars=null;_barWidth=null;getNumberOfBars()});_chart.plotData=function(){var layers=_chart.chartBodyG().selectAll("g.stack").data(_chart.stackLayers());calculateBarWidth();layers.enter().append("g").attr("class",function(d,i){return"stack "+"_"+i});layers.each(function(d,i){var layer=d3.select(this);renderBars(layer,d,i)});_chart.stackLayers(null)};function barHeight(d){return Math.abs(_chart.y()(d.y+d.y0)-_chart.y()(d.y0))}function renderBars(layer,d,i){var bars=layer.selectAll("rect.bar").data(d.points);bars.enter().append("rect").attr("class","bar").attr("fill",function(d){return _chart.colors()(i)}).append("title").text(_chart.title());dc.transition(bars,_chart.transitionDuration()).attr("x",function(d){var x=_chart.x()(d.x);if(_centerBar)x-=_barWidth/2;return x}).attr("y",function(d){var y=_chart.y()(d.y+d.y0);if(d.y<0)y-=barHeight(d);return y}).attr("width",_barWidth).attr("height",function(d){return barHeight(d)}).select("title").text(_chart.title());dc.transition(bars.exit(),_chart.transitionDuration()).attr("height",0).remove()}function calculateBarWidth(){if(_barWidth==null){var numberOfBars=_chart.isOrdinal()?getNumberOfBars()+1:getNumberOfBars();var w=Math.floor((_chart.xAxisLength()-(numberOfBars-1)*_gap)/numberOfBars);if(w==Infinity||isNaN(w)||w<MIN_BAR_WIDTH)w=MIN_BAR_WIDTH;_barWidth=w}}function getNumberOfBars(){if(_numberOfBars==null){_numberOfBars=_chart.xUnitCount()}return _numberOfBars}_chart.fadeDeselectedArea=function(){var bars=_chart.chartBodyG().selectAll("rect.bar");var extent=_chart.brush().extent();if(_chart.isOrdinal()){if(_chart.hasFilter()){bars.classed(dc.constants.SELECTED_CLASS,function(d){return _chart.hasFilter(_chart.keyAccessor()(d.data))});bars.classed(dc.constants.DESELECTED_CLASS,function(d){return!_chart.hasFilter(_chart.keyAccessor()(d.data))})}else{bars.classed(dc.constants.SELECTED_CLASS,false);bars.classed(dc.constants.DESELECTED_CLASS,false)}}else{if(!_chart.brushIsEmpty(extent)){var start=extent[0];var end=extent[1];bars.classed(dc.constants.DESELECTED_CLASS,function(d){var xValue=_chart.keyAccessor()(d.data);return xValue<start||xValue>=end})}else{bars.classed(dc.constants.DESELECTED_CLASS,false)}}};_chart.centerBar=function(_){if(!arguments.length)return _centerBar;_centerBar=_;return _chart};_chart.gap=function(_){if(!arguments.length)return _gap;_gap=_;return _chart};_chart.extendBrush=function(){var extent=_chart.brush().extent();if(_chart.round()&&!_centerBar){extent[0]=extent.map(_chart.round())[0];extent[1]=extent.map(_chart.round())[1];_chart.chartBodyG().select(".brush").call(_chart.brush().extent(extent))}return extent};dc.override(_chart,"prepareOrdinalXAxis",function(){return this._prepareOrdinalXAxis(_chart.xUnitCount()+1)});dc.override(_chart,"xAxisMax",function(){var max=this._xAxisMax();if("resolution"in _chart.xUnits()){var res=_chart.xUnits().resolution;max+=res}return max});return _chart.anchor(parent,chartGroup)};dc.lineChart=function(parent,chartGroup){var DEFAULT_DOT_RADIUS=5;var TOOLTIP_G_CLASS="dc-tooltip";var DOT_CIRCLE_CLASS="dot";var Y_AXIS_REF_LINE_CLASS="yRef";var X_AXIS_REF_LINE_CLASS="xRef";var _chart=dc.stackableChart(dc.coordinateGridChart({}));var _renderArea=false;var _dotRadius=DEFAULT_DOT_RADIUS;_chart.transitionDuration(500);_chart.plotData=function(){var layers=_chart.chartBodyG().selectAll("g.stack").data(_chart.stackLayers());var layersEnter=layers.enter().append("g").attr("class",function(d,i){return"stack "+"_"+i});drawLine(layersEnter,layers);drawArea(layersEnter,layers);drawDots(layers);_chart.stackLayers(null)};_chart.renderArea=function(_){if(!arguments.length)return _renderArea;_renderArea=_;return _chart};function drawLine(layersEnter,layers){var line=d3.svg.line().x(function(d){return _chart.x()(d.x)}).y(function(d){return _chart.y()(d.y+d.y0)});layersEnter.append("path").attr("class","line").attr("stroke",function(d,i){return _chart.colors()(i)});dc.transition(layers.select("path.line"),_chart.transitionDuration()).attr("d",function(d){return line(d.points)})}function drawArea(layersEnter,layers){if(_renderArea){var area=d3.svg.area().x(function(d){return _chart.x()(d.x)}).y(function(d){return _chart.y()(d.y+d.y0)}).y0(function(d){return _chart.y()(d.y0)});layersEnter.append("path").attr("class","area").attr("fill",function(d,i){return _chart.colors()(i)}).attr("d",function(d){return area(d.points)});dc.transition(layers.select("path.area"),_chart.transitionDuration()).attr("d",function(d){return area(d.points)})}}function drawDots(layersEnter){if(!_chart.brushOn()){layersEnter.each(function(d,i){var layer=d3.select(this);var g=layer.append("g").attr("class",TOOLTIP_G_CLASS);createRefLines(g);var dots=g.selectAll("circle."+DOT_CIRCLE_CLASS).data(g.datum().points);dots.enter().append("circle").attr("class",DOT_CIRCLE_CLASS).attr("r",_dotRadius).attr("fill",function(d){return _chart.colors()(i)}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("mousemove",function(d){var dot=d3.select(this);showDot(dot);showRefLines(dot,g)}).on("mouseout",function(d){var dot=d3.select(this);hideDot(dot);hideRefLines(g)}).append("title").text(_chart.title());dots.attr("cx",function(d){return _chart.x()(d.x)}).attr("cy",function(d){return _chart.y()(d.y+d.y0)}).select("title").text(_chart.title());dots.exit().remove()})}}function createRefLines(g){var yRefLine=g.select("path."+Y_AXIS_REF_LINE_CLASS).empty()?g.append("path").attr("class",Y_AXIS_REF_LINE_CLASS):g.select("path."+Y_AXIS_REF_LINE_CLASS);yRefLine.style("display","none").attr("stroke-dasharray","5,5");var xRefLine=g.select("path."+X_AXIS_REF_LINE_CLASS).empty()?g.append("path").attr("class",X_AXIS_REF_LINE_CLASS):g.select("path."+X_AXIS_REF_LINE_CLASS);xRefLine.style("display","none").attr("stroke-dasharray","5,5")}function showDot(dot){dot.style("fill-opacity",.8);dot.style("stroke-opacity",.8);return dot}function showRefLines(dot,g){var x=dot.attr("cx");var y=dot.attr("cy");g.select("path."+Y_AXIS_REF_LINE_CLASS).style("display","").attr("d","M0 "+y+"L"+x+" "+y);g.select("path."+X_AXIS_REF_LINE_CLASS).style("display","").attr("d","M"+x+" "+_chart.yAxisHeight()+"L"+x+" "+y)}function hideDot(dot){dot.style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}function hideRefLines(g){g.select("path."+Y_AXIS_REF_LINE_CLASS).style("display","none");g.select("path."+X_AXIS_REF_LINE_CLASS).style("display","none")}_chart.dotRadius=function(_){if(!arguments.length)return _dotRadius;_dotRadius=_;return _chart};return _chart.anchor(parent,chartGroup)};dc.dataCount=function(parent,chartGroup){var _formatNumber=d3.format(",d");var _chart=dc.baseChart({});_chart.doRender=function(){_chart.selectAll(".total-count").text(_formatNumber(_chart.dimension().size()));_chart.selectAll(".filter-count").text(_formatNumber(_chart.group().value()));return _chart};_chart.doRedraw=function(){return _chart.doRender()};return _chart.anchor(parent,chartGroup)};dc.dataTable=function(parent,chartGroup){var LABEL_CSS_CLASS="dc-table-label";var ROW_CSS_CLASS="dc-table-row";var COLUMN_CSS_CLASS="dc-table-column";var GROUP_CSS_CLASS="dc-table-group";var _chart=dc.baseChart({});var _size=25;var _columns=[];var _sortBy=function(d){return d};var _order=d3.ascending;var _sort;_chart.doRender=function(){_chart.selectAll("tbody").remove();renderRows(renderGroups());return _chart};function renderGroups(){var groups=_chart.root().selectAll("tbody").data(nestEntries(),function(d){return _chart.keyAccessor()(d)});var rowGroup=groups.enter().append("tbody");rowGroup.append("tr").attr("class",GROUP_CSS_CLASS).append("td").attr("class",LABEL_CSS_CLASS).attr("colspan",_columns.length).html(function(d){return _chart.keyAccessor()(d)});groups.exit().remove();return rowGroup}function nestEntries(){if(!_sort)_sort=crossfilter.quicksort.by(_sortBy);var entries=_chart.dimension().top(_size);return d3.nest().key(_chart.group()).sortKeys(_order).sortValues(_order).entries(_sort(entries,0,entries.length))}function renderRows(groups){var rows=groups.order().selectAll("tr."+ROW_CSS_CLASS).data(function(d){return d.values});var rowEnter=rows.enter().append("tr").attr("class",ROW_CSS_CLASS);for(var i=0;i<_columns.length;++i){var f=_columns[i];rowEnter.append("td").attr("class",COLUMN_CSS_CLASS+" _"+i).html(function(d){return f(d)})}rows.exit().remove();return rows}_chart.doRedraw=function(){return _chart.doRender()};_chart.size=function(s){if(!arguments.length)return _size;_size=s;return _chart};_chart.columns=function(_){if(!arguments.length)return _columns;_columns=_;return _chart};_chart.sortBy=function(_){if(!arguments.length)return _sortBy;_sortBy=_;return _chart};_chart.order=function(_){if(!arguments.length)return _order;_order=_;return _chart};return _chart.anchor(parent,chartGroup)};dc.bubbleChart=function(parent,chartGroup){var _chart=dc.abstractBubbleChart(dc.coordinateGridChart({}));var _elasticRadius=false;_chart.transitionDuration(750);var bubbleLocator=function(d){return"translate("+bubbleX(d)+","+bubbleY(d)+")"};_chart.elasticRadius=function(_){if(!arguments.length)return _elasticRadius;_elasticRadius=_;return _chart};_chart.plotData=function(){if(_elasticRadius)_chart.r().domain([_chart.rMin(),_chart.rMax()]);_chart.r().range([_chart.MIN_RADIUS,_chart.xAxisLength()*_chart.maxBubbleRelativeSize()]);var bubbleG=_chart.chartBodyG().selectAll("g."+_chart.BUBBLE_NODE_CLASS).data(_chart.group().all());renderNodes(bubbleG);updateNodes(bubbleG);removeNodes(bubbleG);_chart.fadeDeselectedArea()};function renderNodes(bubbleG){var bubbleGEnter=bubbleG.enter().append("g");bubbleGEnter.attr("class",_chart.BUBBLE_NODE_CLASS).attr("transform",bubbleLocator).append("circle").attr("class",function(d,i){return _chart.BUBBLE_CLASS+" _"+i}).on("click",_chart.onClick).attr("fill",_chart.initBubbleColor).attr("r",0);dc.transition(bubbleG,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d)}).attr("opacity",function(d){return _chart.bubbleR(d)>0?1:0});_chart.doRenderLabel(bubbleGEnter);_chart.doRenderTitles(bubbleGEnter)}function updateNodes(bubbleG){dc.transition(bubbleG,_chart.transitionDuration()).attr("transform",bubbleLocator).selectAll("circle."+_chart.BUBBLE_CLASS).attr("fill",_chart.updateBubbleColor).attr("r",function(d){return _chart.bubbleR(d)}).attr("opacity",function(d){return _chart.bubbleR(d)>0?1:0});_chart.doUpdateLabels(bubbleG);_chart.doUpdateTitles(bubbleG)}function removeNodes(bubbleG){bubbleG.exit().remove()}function bubbleX(d){var x=_chart.x()(_chart.keyAccessor()(d))+_chart.margins().left;if(isNaN(x))x=0;return x}function bubbleY(d){var y=_chart.margins().top+_chart.y()(_chart.valueAccessor()(d));if(isNaN(y))y=0;return y}_chart.renderBrush=function(g){};_chart.redrawBrush=function(g){_chart.fadeDeselectedArea()};return _chart.anchor(parent,chartGroup)};dc.compositeChart=function(parent,chartGroup){var SUB_CHART_CLASS="sub";var _chart=dc.coordinateGridChart({});var _children=[];_chart.transitionDuration(500);dc.override(_chart,"generateG",function(){var g=this._generateG();for(var i=0;i<_children.length;++i){var child=_children[i];generateChildG(child,i);if(child.dimension()==null)child.dimension(_chart.dimension());if(child.group()==null)child.group(_chart.group());child.chartGroup(_chart.chartGroup());child.svg(_chart.svg());child.xUnits(_chart.xUnits());child.transitionDuration(_chart.transitionDuration());child.brushOn(_chart.brushOn())}return g});function generateChildG(child,i){child.generateG(_chart.g());child.g().attr("class",SUB_CHART_CLASS+" _"+i)}_chart.plotData=function(){for(var i=0;i<_children.length;++i){var child=_children[i];if(child.g()==null){generateChildG(child,i)}child.x(_chart.x());child.y(_chart.y());child.xAxis(_chart.xAxis());child.yAxis(_chart.yAxis());child.plotData();child.activateRenderlets()}};_chart.fadeDeselectedArea=function(){for(var i=0;i<_children.length;++i){var child=_children[i];child.brush(_chart.brush());child.fadeDeselectedArea()}};_chart.compose=function(charts){_children=charts;for(var i=0;i<_children.length;++i){var child=_children[i];child.height(_chart.height());child.width(_chart.width());child.margins(_chart.margins())}return _chart};_chart.children=function(){return _children};function getAllYAxisMinFromChildCharts(){var allMins=[];for(var i=0;i<_children.length;++i){allMins.push(_children[i].yAxisMin())}return allMins}_chart.yAxisMin=function(){return d3.min(getAllYAxisMinFromChildCharts())};function getAllYAxisMaxFromChildCharts(){var allMaxes=[];for(var i=0;i<_children.length;++i){allMaxes.push(_children[i].yAxisMax())}return allMaxes}_chart.yAxisMax=function(){return dc.utils.add(d3.max(getAllYAxisMaxFromChildCharts()),_chart.yAxisPadding())};function getAllXAxisMinFromChildCharts(){var allMins=[];for(var i=0;i<_children.length;++i){allMins.push(_children[i].xAxisMin())}return allMins}_chart.xAxisMin=function(){return dc.utils.subtract(d3.min(getAllXAxisMinFromChildCharts()),_chart.xAxisPadding())};function getAllXAxisMaxFromChildCharts(){var allMaxes=[];for(var i=0;i<_children.length;++i){allMaxes.push(_children[i].xAxisMax())}return allMaxes}_chart.xAxisMax=function(){return dc.utils.add(d3.max(getAllXAxisMaxFromChildCharts()),_chart.xAxisPadding())};return _chart.anchor(parent,chartGroup)};dc.geoChoroplethChart=function(parent,chartGroup){var _chart=dc.colorChart(dc.baseChart({}));_chart.colorAccessor(function(d,i){return d});var _geoPath=d3.geo.path();var _projectionFlag;var _geoJsons=[];_chart.doRender=function(){_chart.resetSvg();for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){var states=_chart.svg().append("g").attr("class","layer"+layerIndex);var regionG=states.selectAll("g."+geoJson(layerIndex).name).data(geoJson(layerIndex).data).enter().append("g").attr("class",geoJson(layerIndex).name);regionG.append("path").attr("fill","white").attr("d",_geoPath);regionG.append("title");plotData(layerIndex)}_projectionFlag=false};function plotData(layerIndex){var maxValue=dc.utils.groupMax(_chart.group(),_chart.valueAccessor());var data=generateLayeredData();if(isDataLayer(layerIndex)){var regionG=renderRegionG(layerIndex);renderPaths(regionG,layerIndex,data,maxValue);renderTitle(regionG,layerIndex,data)}}function generateLayeredData(){var data={};var groupAll=_chart.group().all();for(var i=0;i<groupAll.length;++i){data[_chart.keyAccessor()(groupAll[i])]=_chart.valueAccessor()(groupAll[i])}return data}function isDataLayer(layerIndex){return geoJson(layerIndex).keyAccessor}function renderRegionG(layerIndex){var regionG=_chart.svg().selectAll(layerSelector(layerIndex)).classed("selected",function(d){return isSelected(layerIndex,d)}).classed("deselected",function(d){return isDeselected(layerIndex,d)}).attr("class",function(d){var layerNameClass=geoJson(layerIndex).name;var regionClass=dc.utils.nameToId(geoJson(layerIndex).keyAccessor(d));var baseClasses=layerNameClass+" "+regionClass;if(isSelected(layerIndex,d))baseClasses+=" selected";if(isDeselected(layerIndex,d))baseClasses+=" deselected";return baseClasses});return regionG}function layerSelector(layerIndex){return"g.layer"+layerIndex+" g."+geoJson(layerIndex).name}function isSelected(layerIndex,d){return _chart.hasFilter()&&_chart.hasFilter(getKey(layerIndex,d))}function isDeselected(layerIndex,d){return _chart.hasFilter()&&!_chart.hasFilter(getKey(layerIndex,d))}function getKey(layerIndex,d){return geoJson(layerIndex).keyAccessor(d)}function geoJson(index){return _geoJsons[index]}function renderPaths(regionG,layerIndex,data,maxValue){var paths=regionG.select("path").attr("fill",function(d){var currentFill=d3.select(this).attr("fill");if(currentFill)return currentFill;return"none"}).on("click",function(d){return _chart.onClick(d,layerIndex)});dc.transition(paths,_chart.transitionDuration()).attr("fill",function(d,i){return _chart.getColor(data[geoJson(layerIndex).keyAccessor(d)],i)})}_chart.onClick=function(d,layerIndex){var selectedRegion=geoJson(layerIndex).keyAccessor(d);dc.events.trigger(function(){_chart.filter(selectedRegion);dc.redrawAll(_chart.chartGroup())})};function renderTitle(regionG,layerIndex,data){if(_chart.renderTitle()){regionG.selectAll("title").text(function(d){var key=getKey(layerIndex,d);var value=data[key];return _chart.title()({key:key,value:value})})}}_chart.doRedraw=function(){for(var layerIndex=0;layerIndex<_geoJsons.length;++layerIndex){plotData(layerIndex);if(_projectionFlag){_chart.svg().selectAll("g."+geoJson(layerIndex).name+" path").attr("d",_geoPath)}}_projectionFlag=false};_chart.overlayGeoJson=function(json,name,keyAccessor){for(var i=0;i<_geoJsons.length;++i){if(_geoJsons[i].name==name){_geoJsons[i].data=json;_geoJsons[i].keyAccessor=keyAccessor;return _chart}}_geoJsons.push({name:name,data:json,keyAccessor:keyAccessor});return _chart};_chart.projection=function(projection){_geoPath.projection(projection);_projectionFlag=true;return _chart};_chart.geoJsons=function(){return _geoJsons};_chart.removeGeoJson=function(name){var geoJsons=[];for(var i=0;i<_geoJsons.length;++i){var layer=_geoJsons[i];if(layer.name!=name){geoJsons.push(layer)}}_geoJsons=geoJsons;return _chart};return _chart.anchor(parent,chartGroup)};dc.bubbleOverlay=function(root,chartGroup){var BUBBLE_OVERLAY_CLASS="bubble-overlay";var BUBBLE_NODE_CLASS="node";var BUBBLE_CLASS="bubble";var _chart=dc.abstractBubbleChart(dc.baseChart({}));var _g;var _points=[];_chart.transitionDuration(750);_chart.radiusValueAccessor(function(d){return d.value});_chart.point=function(name,x,y){_points.push({name:name,x:x,y:y});return _chart};_chart.doRender=function(){_g=initOverlayG();_chart.r().range([_chart.MIN_RADIUS,_chart.width()*_chart.maxBubbleRelativeSize()]);initializeBubbles();_chart.fadeDeselectedArea();return _chart};function initOverlayG(){_g=_chart.select("g."+BUBBLE_OVERLAY_CLASS);if(_g.empty())_g=_chart.svg().append("g").attr("class",BUBBLE_OVERLAY_CLASS);return _g}function initializeBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select("circle."+BUBBLE_CLASS);if(circle.empty())circle=nodeG.append("circle").attr("class",BUBBLE_CLASS).attr("r",0).attr("fill",_chart.initBubbleColor).on("click",_chart.onClick);dc.transition(circle,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d)});_chart.doRenderLabel(nodeG);_chart.doRenderTitles(nodeG)})}function mapData(){var data={};_chart.group().all().forEach(function(datum){data[_chart.keyAccessor()(datum)]=datum});return data}function getNodeG(point,data){var bubbleNodeClass=BUBBLE_NODE_CLASS+" "+dc.utils.nameToId(point.name);var nodeG=_g.select("g."+dc.utils.nameToId(point.name));if(nodeG.empty()){nodeG=_g.append("g").attr("class",bubbleNodeClass).attr("transform","translate("+point.x+","+point.y+")")}nodeG.datum(data[point.name]);return nodeG}_chart.doRedraw=function(){updateBubbles();_chart.fadeDeselectedArea();return _chart};function updateBubbles(){var data=mapData();_points.forEach(function(point){var nodeG=getNodeG(point,data);var circle=nodeG.select("circle."+BUBBLE_CLASS);dc.transition(circle,_chart.transitionDuration()).attr("r",function(d){return _chart.bubbleR(d)}).attr("fill",_chart.updateBubbleColor);_chart.doUpdateLabels(nodeG);_chart.doUpdateTitles(nodeG)})}_chart.debug=function(flag){if(flag){var debugG=_chart.select("g."+dc.constants.DEBUG_GROUP_CLASS);if(debugG.empty())debugG=_chart.svg().append("g").attr("class",dc.constants.DEBUG_GROUP_CLASS);var debugText=debugG.append("text").attr("x",10).attr("y",20);debugG.append("rect").attr("width",_chart.width()).attr("height",_chart.height()).on("mousemove",function(){var position=d3.mouse(debugG.node());var msg=position[0]+", "+position[1];debugText.text(msg)})}else{_chart.selectAll(".debug").remove()}return _chart};_chart.anchor(root,chartGroup);return _chart};dc.rowChart=function(parent,chartGroup){var _g;var _labelOffsetX=10;var _labelOffsetY=15;var _gap=5;var _rowCssClass="row";var _chart=dc.marginable(dc.colorChart(dc.baseChart({})));var _xScale;var _elasticX;var _xAxis=d3.svg.axis().orient("bottom");function calculateAxisScale(){if(!_xScale||_elasticX){_xScale=d3.scale.linear().domain([0,d3.max(_chart.group().all(),_chart.valueAccessor())]).range([0,_chart.effectiveWidth()]);_xAxis.scale(_xScale)}}function drawAxis(){var axisG=_g.select("g.axis");calculateAxisScale();if(axisG.empty())axisG=_g.append("g").attr("class","axis").attr("transform","translate(0, "+_chart.effectiveHeight()+")");dc.transition(axisG,_chart.transitionDuration()).call(_xAxis)}_chart.doRender=function(){_chart.resetSvg();_g=_chart.svg().append("g").attr("transform","translate("+_chart.margins().left+","+_chart.margins().top+")");drawAxis();drawGridLines();drawChart();return _chart};_chart.title(function(d){return _chart.keyAccessor()(d)+": "+_chart.valueAccessor()(d)});_chart.label(function(d){return _chart.keyAccessor()(d)});function drawGridLines(){_g.selectAll("g.tick").select("line.grid-line").remove();_g.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(d){return-_chart.effectiveHeight()})}function drawChart(){drawAxis();drawGridLines();var rows=_g.selectAll("g."+_rowCssClass).data(_chart.group().all());createElements(rows);removeElements(rows);updateElements(rows)}function createElements(rows){var rowEnter=rows.enter().append("g").attr("class",function(d,i){return _rowCssClass+" _"+i});rowEnter.append("rect").attr("width",0);createLabels(rowEnter);
updateLabels(rows)}function removeElements(rows){rows.exit().remove()}function updateElements(rows){var height=rowHeight();rows=rows.attr("transform",function(d,i){return"translate(0,"+((i+1)*_gap+i*height)+")"}).select("rect").attr("height",height).attr("fill",_chart.getColor).on("click",onClick).classed("deselected",function(d){return _chart.hasFilter()?!_chart.isSelectedRow(d):false}).classed("selected",function(d){return _chart.hasFilter()?_chart.isSelectedRow(d):false});dc.transition(rows,_chart.transitionDuration()).attr("width",function(d){return _xScale(_chart.valueAccessor()(d))});createTitles(rows)}function createTitles(rows){if(_chart.renderTitle()){rows.selectAll("title").remove();rows.append("title").text(function(d){return _chart.title()(d)})}}function createLabels(rowEnter){if(_chart.renderLabel()){rowEnter.append("text").on("click",onClick)}}function updateLabels(rows){if(_chart.renderLabel()){rows.select("text").attr("x",_labelOffsetX).attr("y",_labelOffsetY).attr("class",function(d,i){return _rowCssClass+" _"+i}).text(function(d){return _chart.label()(d)})}}function numberOfRows(){return _chart.group().all().length}function rowHeight(){var n=numberOfRows();return(_chart.effectiveHeight()-(n+1)*_gap)/n}function onClick(d){_chart.onClick(d)}_chart.doRedraw=function(){drawChart();return _chart};_chart.xAxis=function(){return _xAxis};_chart.gap=function(g){if(!arguments.length)return _gap;_gap=g;return _chart};_chart.elasticX=function(_){if(!arguments.length)return _elasticX;_elasticX=_;return _chart};_chart.labelOffsetX=function(o){if(!arguments.length)return _labelOffsetX;_labelOffsetX=o;return _chart};_chart.labelOffsetY=function(o){if(!arguments.length)return _labelOffsetY;_labelOffsetY=o;return _chart};_chart.isSelectedRow=function(d){return _chart.hasFilter(_chart.keyAccessor()(d))};return _chart.anchor(parent,chartGroup)};
=======
dc={version:"1.6.0-dev",constants:{CHART_CLASS:"dc-chart",DEBUG_GROUP_CLASS:"debug",STACK_CLASS:"stack",DESELECTED_CLASS:"deselected",SELECTED_CLASS:"selected",NODE_INDEX_NAME:"__index__",GROUP_INDEX_NAME:"__group_index__",DEFAULT_CHART_GROUP:"__default_chart_group__",EVENT_DELAY:40,NEGLIGIBLE_NUMBER:1e-10},_renderlet:null},dc.chartRegistry=function(){function a(a){return a||(a=dc.constants.DEFAULT_CHART_GROUP),b[a]||(b[a]=[]),a}var b={};return{has:function(a){for(var c in b)if(b[c].indexOf(a)>=0)return!0;return!1},register:function(c,d){d=a(d),b[d].push(c)},clear:function(){b={}},list:function(c){return c=a(c),b[c]}}}(),dc.registerChart=function(a,b){dc.chartRegistry.register(a,b)},dc.hasChart=function(a){return dc.chartRegistry.has(a)},dc.deregisterAllCharts=function(){dc.chartRegistry.clear()},dc.filterAll=function(a){for(var b=dc.chartRegistry.list(a),c=0;c<b.length;++c)b[c].filterAll()},dc.renderAll=function(a){for(var b=dc.chartRegistry.list(a),c=0;c<b.length;++c)b[c].render();null!==dc._renderlet&&dc._renderlet(a)},dc.redrawAll=function(a){for(var b=dc.chartRegistry.list(a),c=0;c<b.length;++c)b[c].redraw();null!==dc._renderlet&&dc._renderlet(a)},dc.transition=function(a,b,c){if(0>=b||void 0===b)return a;var d=a.transition().duration(b);return c instanceof Function&&c(d),d},dc.units={},dc.units.integers=function(a,b){return Math.abs(b-a)},dc.units.ordinal=function(a,b,c){return c},dc.units.fp={},dc.units.fp.precision=function(a){var b=function(a,c){return Math.ceil(Math.abs((c-a)/b.resolution))};return b.resolution=a,b},dc.round={},dc.round.floor=function(a){return Math.floor(a)},dc.round.ceil=function(a){return Math.ceil(a)},dc.round.round=function(a){return Math.round(a)},dc.override=function(a,b,c){var d=a[b];a["_"+b]=d,a[b]=c},dc.renderlet=function(a){return arguments.length?(dc._renderlet=a,dc):dc._renderlet},dc.instanceOfChart=function(a){return a instanceof Object&&a.__dc_flag__},dc.errors={},dc.errors.Exception=function(a){var b=void 0!==a?a:"Unexpected internal error";this.message=b,this.toString=function(){return b}},dc.errors.InvalidStateException=function(){dc.errors.Exception.apply(this,arguments)},dc.dateFormat=d3.time.format("%m/%d/%Y"),dc.printers={},dc.printers.filters=function(a){for(var b="",c=0;c<a.length;++c)c>0&&(b+=", "),b+=dc.printers.filter(a[c]);return b},dc.printers.filter=function(a){var b="";return a&&(a instanceof Array?a.length>=2?b="["+dc.utils.printSingleValue(a[0])+" -> "+dc.utils.printSingleValue(a[1])+"]":a.length>=1&&(b=dc.utils.printSingleValue(a[0])):b=dc.utils.printSingleValue(a)),b},dc.utils={},dc.utils.printSingleValue=function(a){var b=""+a;return a instanceof Date?b=dc.dateFormat(a):"string"==typeof a?b=a:dc.utils.isFloat(a)?b=dc.utils.printSingleValue.fformat(a):dc.utils.isInteger(a)&&(b=Math.round(a)),b},dc.utils.printSingleValue.fformat=d3.format(".2f"),dc.utils.add=function(a,b){if("string"==typeof b&&(b=b.replace("%","")),a instanceof Date){"string"==typeof b&&(b=+b);var c=new Date;return c.setTime(a.getTime()),c.setDate(a.getDate()+b),c}if("string"==typeof b){var d=+b/100;return a>0?a*(1+d):a*(1-d)}return a+b},dc.utils.subtract=function(a,b){if("string"==typeof b&&(b=b.replace("%","")),a instanceof Date){"string"==typeof b&&(b=+b);var c=new Date;return c.setTime(a.getTime()),c.setDate(a.getDate()-b),c}if("string"==typeof b){var d=+b/100;return 0>a?a*(1+d):a*(1-d)}return a-b},dc.utils.GroupStack=function(){function a(a){c[a]||(c[a]=[])}var b,c=[],d=[];this.setDataPoint=function(b,d,e){a(b),c[b][d]=e},this.getDataPoint=function(b,d){a(b);var e=c[b][d];return void 0===e&&(e=0),e},this.addGroup=function(a,c){return c||(c=b),d.push([a,c]),d.length-1},this.getGroupByIndex=function(a){return d[a][0]},this.getAccessorByIndex=function(a){return d[a][1]},this.size=function(){return d.length},this.clear=function(){c=[],d=[]},this.setDefaultAccessor=function(a){b=a},this.getDataLayers=function(){return c},this.toLayers=function(){for(var a=[],b=0;b<c.length;++b){for(var d={index:b,points:[]},e=c[b],f=0;f<e.length;++f)d.points.push(e[f]);a.push(d)}return a}},dc.utils.isFloat=function(a){return a===+a&&a!==(0|a)},dc.utils.isInteger=function(a){return a===+a&&a===(0|a)},dc.utils.isNegligible=function(a){return void 0===a||a<dc.constants.NEGLIGIBLE_NUMBER&&a>-dc.constants.NEGLIGIBLE_NUMBER},dc.utils.groupMax=function(a,b){var c=d3.max(a.all(),function(a){return b(a)});return dc.utils.isNegligible(c)&&(c=0),c},dc.utils.groupMin=function(a,b){var c=d3.min(a.all(),function(a){return b(a)});return dc.utils.isNegligible(c)&&(c=0),c},dc.utils.nameToId=function(a){return a.toLowerCase().replace(/[\s]/g,"_").replace(/[\.']/g,"")},dc.utils.appendOrSelect=function(a,b){var c=a.select(b);return c.empty()&&(c=a.append(b)),c},dc.utils.createLegendable=function(a,b,c,d){var e={name:a.getGroupName(b,d),data:b};return"function"==typeof a.colors&&(e.color=a.colors()(c)),e},dc.utils.safeNumber=function(a){return isNaN(a)?0:a},dc.events={current:null},dc.events.trigger=function(a,b){return b?(dc.events.current=a,setTimeout(function(){a==dc.events.current&&a()},b),void 0):(a(),void 0)},dc.cumulative={},dc.cumulative.Base=function(){this._keyIndex=[],this._map={},this.sanitizeKey=function(a){return a+=""},this.clear=function(){this._keyIndex=[],this._map={}},this.size=function(){return this._keyIndex.length},this.getValueByKey=function(a){a=this.sanitizeKey(a);var b=this._map[a];return b},this.setValueByKey=function(a,b){return a=this.sanitizeKey(a),this._map[a]=b},this.indexOfKey=function(a){return a=this.sanitizeKey(a),this._keyIndex.indexOf(a)},this.addToIndex=function(a){a=this.sanitizeKey(a),this._keyIndex.push(a)},this.getKeyByIndex=function(a){return this._keyIndex[a]}},dc.cumulative.Sum=function(){dc.cumulative.Base.apply(this,arguments),this.add=function(a,b){b||(b=0),void 0===this.getValueByKey(a)?(this.addToIndex(a),this.setValueByKey(a,b)):this.setValueByKey(a,this.getValueByKey(a)+b)},this.minus=function(a,b){this.setValueByKey(a,this.getValueByKey(a)-b)},this.cumulativeSum=function(a){var b=this.indexOfKey(a);if(0>b)return 0;for(var c=0,d=0;b>=d;++d){var e=this.getKeyByIndex(d);c+=this.getValueByKey(e)}return c}},dc.cumulative.Sum.prototype=new dc.cumulative.Base,dc.cumulative.CountUnique=function(){function a(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c}dc.cumulative.Base.apply(this,arguments),this.add=function(a,b){void 0===this.getValueByKey(a)&&(this.setValueByKey(a,{}),this.addToIndex(a)),void 0!==b&&(void 0===this.getValueByKey(a)[b]&&(this.getValueByKey(a)[b]=0),this.getValueByKey(a)[b]+=1)},this.minus=function(a,b){this.getValueByKey(a)[b]-=1,this.getValueByKey(a)[b]<=0&&delete this.getValueByKey(a)[b]},this.count=function(b){return a(this.getValueByKey(b))},this.cumulativeCount=function(a){var b=this.indexOfKey(a);if(0>b)return 0;for(var c=0,d=0;b>=d;++d){var e=this.getKeyByIndex(d);c+=this.count(e)}return c}},dc.cumulative.CountUnique.prototype=new dc.cumulative.Base,dc.baseChart=function(a){function b(b){var c="default";return b?b==a.valueAccessor()?c:b:c}function c(b){B.splice(B.indexOf(b),1),f(),a.invokeFilteredListener(a,b)}function d(b){B.push(b),f(),a.invokeFilteredListener(a,b)}function e(){B=[],f(),a.invokeFilteredListener(a,null)}function f(){if(a.dataSet()&&void 0!==a.dimension().filter){var b=C(a.dimension(),B);B=b?b:B}}function g(){for(var b=0;b<x.length;++b)x[b](a)}a.__dc_flag__=!0;var h,i,j,k,l,m,n=200,o=200,p=function(a){return a.key},q=function(a){return a.value},r=function(a){return a.key},s=!1,t=function(a){return a.key+": "+a.value},u=!1,v=750,w=dc.printers.filters,x=[],y=dc.constants.DEFAULT_CHART_GROUP,z=function(){},A={preRender:z,postRender:z,preRedraw:z,postRedraw:z,filtered:z,zoomed:z},B=[],C=function(a,b){return a.filter(null),0===b.length?a.filter(null):1===b.length?a.filter(b[0]):a.filterFunction(function(a){return b.indexOf(a)>=0}),b};return a.width=function(b){return arguments.length?(n=b,a):n},a.height=function(b){return arguments.length?(o=b,a):o},a.dimension=function(b){return arguments.length?(h=b,a.expireCache(),a):h},a.group=function(b,c){return arguments.length?(i=b,a.expireCache(),"string"==typeof c&&a.setGroupName(i,c),a):i},a.setGroupName=function(a,c,d){a.__names__||(a.__names__={}),a.__names__[b(d)]=c},a.getGroupName=function(a,c){return a.__names__||(a.__names__={}),a.__names__[b(c)]},a.orderedGroup=function(){return i.order(function(a){return a.key})},a.filterAll=function(){return a.filter(null)},a.dataSet=function(){return void 0!==h&&void 0!==i},a.select=function(a){return k.select(a)},a.selectAll=function(a){return k?k.selectAll(a):null},a.anchor=function(b,c){return arguments.length?(dc.instanceOfChart(b)?(j=b.anchor(),k=b.root()):(j=b,k=d3.select(j),k.classed(dc.constants.CHART_CLASS,!0),dc.registerChart(a,c)),y=c,a):j},a.anchorName=function(){var b=a.anchor();return b&&b.id?b.id:b?b.replace("#",""):""},a.root=function(b){return arguments.length?(k=b,a):k},a.svg=function(b){return arguments.length?(l=b,a):l},a.resetSvg=function(){return a.select("svg").remove(),a.generateSvg()},a.generateSvg=function(){return l=a.root().append("svg").attr("width",a.width()).attr("height",a.height())},a.filterPrinter=function(b){return arguments.length?(w=b,a):w},a.turnOnControls=function(){return k&&(a.selectAll(".reset").style("display",null),a.selectAll(".filter").text(w(a.filters())).style("display",null)),a},a.turnOffControls=function(){return k&&(a.selectAll(".reset").style("display","none"),a.selectAll(".filter").style("display","none").text(a.filter())),a},a.transitionDuration=function(b){return arguments.length?(v=b,a):v},a.render=function(){if(A.preRender(a),void 0===h)throw new dc.errors.InvalidStateException("Mandatory attribute chart.dimension is missing on chart[#"+a.anchorName()+"]");if(void 0===i)throw new dc.errors.InvalidStateException("Mandatory attribute chart.group is missing on chart[#"+a.anchorName()+"]");var b=a.doRender();return m&&m.render(),a.activateRenderlets("postRender"),b},a.activateRenderlets=function(b){a.transitionDuration()>0&&l?l.transition().duration(a.transitionDuration()).each("end",function(){g(),b&&A[b](a)}):(g(),b&&A[b](a))},a.redraw=function(){A.preRedraw(a);var b=a.doRedraw();return a.activateRenderlets("postRedraw"),b},a.invokeFilteredListener=function(b,c){void 0!==c&&A.filtered(a,c)},a.invokeZoomedListener=function(){A.zoomed(a)},a.hasFilter=function(a){return arguments.length?B.indexOf(a)>=0:B.length>0},a.filter=function(b){return arguments.length?(null===b?e():a.hasFilter(b)?c(b):d(b),null!==k&&a.hasFilter()?a.turnOnControls():a.turnOffControls(),a):B.length>0?B[0]:null},a.filters=function(){return B},a.highlightSelected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!0),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.fadeDeselected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!0)},a.resetHighlight=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.onClick=function(b){var c=a.keyAccessor()(b);dc.events.trigger(function(){a.filter(c),dc.redrawAll(a.chartGroup())})},a.filterHandler=function(b){return arguments.length?(C=b,a):C},a.doRender=function(){return a},a.doRedraw=function(){return a},a.legendables=function(){return[]},a.legendHighlight=function(){},a.legendReset=function(){},a.keyAccessor=function(b){return arguments.length?(p=b,a):p},a.valueAccessor=function(b){return arguments.length?(q=b,a):q},a.label=function(b){return arguments.length?(r=b,s=!0,a):r},a.renderLabel=function(b){return arguments.length?(s=b,a):s},a.title=function(b){return arguments.length?(t=b,u=!0,a):t},a.renderTitle=function(b){return arguments.length?(u=b,a):u},a.renderlet=function(b){return x.push(b),a},a.chartGroup=function(b){return arguments.length?(y=b,a):y},a.on=function(b,c){return A[b]=c,a},a.expireCache=function(){return a},a.legend=function(b){return arguments.length?(m=b,m.parent(a),a):m},a},dc.marginable=function(a){var b={top:10,right:50,bottom:30,left:30};return a.margins=function(c){return arguments.length?(b=c,a):b},a.effectiveWidth=function(){return a.width()-a.margins().left-a.margins().right},a.effectiveHeight=function(){return a.height()-a.margins().top-a.margins().bottom},a},dc.coordinateGridChart=function(a){function b(b){a.elasticX()&&!a.isOrdinal()&&u.domain([a.xAxisMin(),a.xAxisMax()]),a.isOrdinal()?a.prepareOrdinalXAxis():u.range([0,a.xAxisLength()]),B=B.scale(a.x()).orient("bottom"),c(b)}function c(b){var c=b.selectAll("g."+q);if(L){c.empty()&&(c=b.insert("g",":first-child").attr("class",o+" "+q).attr("transform","translate("+a.yAxisX()+","+a.margins().top+")"));var d=B.tickValues()?B.tickValues():u.ticks(B.ticks()[0]),e=c.selectAll("line").data(d),f=e.enter().append("line").attr("x1",function(a){return u(a)}).attr("y1",a.xAxisY()-a.margins().top).attr("x2",function(a){return u(a)}).attr("y2",0).attr("opacity",0);dc.transition(f,a.transitionDuration()).attr("opacity",1),dc.transition(e,a.transitionDuration()).attr("x1",function(a){return u(a)}).attr("y1",a.xAxisY()-a.margins().top).attr("x2",function(a){return u(a)}).attr("y2",0),e.exit().remove()}else c.selectAll("line").remove()}function d(b){(void 0===w||a.elasticY())&&(w=d3.scale.linear(),w.domain([a.yAxisMin(),a.yAxisMax()]).rangeRound([a.yAxisHeight(),0])),w.range([a.yAxisHeight(),0]),F=F.scale(w).orient("left"),e(b)}function e(b){var c=b.selectAll("g."+p);if(K){var d=F.tickValues()?F.tickValues():w.ticks(F.ticks()[0]);c.empty()&&(c=b.insert("g",":first-child").attr("class",o+" "+p).attr("transform","translate("+a.yAxisX()+","+a.margins().top+")"));var e=c.selectAll("line").data(d),f=e.enter().append("line").attr("x1",1).attr("y1",function(a){return w(a)}).attr("x2",a.xAxisLength()).attr("y2",function(a){return w(a)}).attr("opacity",0);dc.transition(f,a.transitionDuration()).attr("opacity",1),dc.transition(e,a.transitionDuration()).attr("x1",1).attr("y1",function(a){return w(a)}).attr("x2",a.xAxisLength()).attr("y2",function(a){return w(a)}),e.exit().remove()}else c.selectAll("line").remove()}function f(){return a.xAxisY()-a.margins().top}function g(){}function h(){var b=a.extendBrush();a.redrawBrush(s),a.brushIsEmpty(b)?dc.events.trigger(function(){a.filter(null),dc.redrawAll(a.chartGroup())}):dc.events.trigger(function(){a.filter(null),a.filter([b[0],b[1]]),dc.redrawAll(a.chartGroup())},dc.constants.EVENT_DELAY)}function i(){}function j(){return a.anchorName()+"-clip"}function k(){var b=dc.utils.appendOrSelect(r,"defs"),c=dc.utils.appendOrSelect(b,"clipPath").attr("id",j()),d=2*O;dc.utils.appendOrSelect(c,"rect").attr("width",a.xAxisLength()+d).attr("height",a.yAxisHeight()+d)}function l(){N&&a.root().call(d3.behavior.zoom().x(a.x()).scaleExtent([1,100]).on("zoom",function(){a.focus(a.x().domain()),a.invokeZoomedListener(a),m()}))}function m(){if(z){var b=a.x().domain(),c=z.xOriginalDomain(),d=[b[0]<c[0]?b[0]:c[0],b[1]>c[1]?b[1]:c[1]];z.focus(d),z.filter(null),z.filter(b),dc.events.trigger(function(){dc.redrawAll(a.chartGroup())})}}function n(a){return a instanceof Array&&a.length>1}var o="grid-line",p="horizontal",q="vertical";a=dc.colorChart(dc.marginable(dc.baseChart(a))),a.colors(d3.scale.category10());var r,s,t,u,v,w,x,y,z,A,B=d3.svg.axis(),C=dc.units.integers,D=0,E=!1,F=d3.svg.axis(),G=0,H=!1,I=d3.svg.brush(),J=!0,K=!1,L=!1,M=!1,N=!1,O=0;return a.title(function(a){return a.data.key+": "+a.data.value}),a.rescale=function(){y=void 0,a.xUnitCount()},a.rangeChart=function(b){return arguments.length?(z=b,z.focusChart(a),a):z},a.generateG=function(b){return r=void 0===b?a.svg():b,s=r.append("g"),t=s.append("g").attr("class","chart-body").attr("transform","translate("+a.margins().left+", "+a.margins().top+")").attr("clip-path","url(#"+j()+")"),s},a.g=function(b){return arguments.length?(s=b,a):s},a.mouseZoomable=function(b){return arguments.length?(N=b,a):N},a.chartBodyG=function(b){return arguments.length?(t=b,a):t},a.x=function(b){return arguments.length?(u=b,v=u.domain(),a):u},a.xOriginalDomain=function(){return v},a.xUnits=function(b){return arguments.length?(C=b,a):C},a.xAxis=function(b){return arguments.length?(B=b,a):B},a.elasticX=function(b){return arguments.length?(E=b,a):E},a.xAxisPadding=function(b){return arguments.length?(D=b,a):D},a.xUnitCount=function(){if(void 0===y){var b=a.xUnits()(a.x().domain()[0],a.x().domain()[1],a.x().domain());y=b instanceof Array?b.length:b}return y},a.isOrdinal=function(){return a.xUnits()===dc.units.ordinal},a.prepareOrdinalXAxis=function(b){b||(b=a.xUnitCount());for(var c=[],d=0,e=a.xAxisLength()/b,f=0;b>f;f++)c[f]=d,d+=e;u.range(c)},a.renderXAxis=function(b){var c=b.selectAll("g.x");c.empty()&&(c=b.append("g").attr("class","axis x").attr("transform","translate("+a.margins().left+","+a.xAxisY()+")")),dc.transition(c,a.transitionDuration()).call(B)},a.xAxisY=function(){return a.height()-a.margins().bottom},a.xAxisLength=function(){return a.effectiveWidth()},a.renderYAxis=function(b){var c=b.selectAll("g.y");c.empty()&&(c=b.append("g").attr("class","axis y").attr("transform","translate("+a.yAxisX()+","+a.margins().top+")")),dc.transition(c,a.transitionDuration()).call(F)},a.yAxisX=function(){return a.margins().left},a.y=function(b){return arguments.length?(w=b,a):w},a.yAxis=function(b){return arguments.length?(F=b,a):F},a.elasticY=function(b){return arguments.length?(H=b,a):H},a.renderHorizontalGridLines=function(b){return arguments.length?(K=b,a):K},a.renderVerticalGridLines=function(b){return arguments.length?(L=b,a):L},a.xAxisMin=function(){var b=d3.min(a.group().all(),function(b){return a.keyAccessor()(b)});return dc.utils.subtract(b,D)},a.xAxisMax=function(){var b=d3.max(a.group().all(),function(b){return a.keyAccessor()(b)});return dc.utils.add(b,D)},a.yAxisMin=function(){var b=d3.min(a.group().all(),function(b){return a.valueAccessor()(b)});return b=dc.utils.subtract(b,G)},a.yAxisMax=function(){var b=d3.max(a.group().all(),function(b){return a.valueAccessor()(b)});return b=dc.utils.add(b,G)},a.yAxisPadding=function(b){return arguments.length?(G=b,a):G},a.yAxisHeight=function(){return a.effectiveHeight()},a.round=function(b){return arguments.length?(x=b,a):x},dc.override(a,"filter",function(b){return arguments.length?(a._filter(b),b?a.brush().extent(b):a.brush().clear(),a):a._filter()}),a.brush=function(b){return arguments.length?(I=b,a):I},a.renderBrush=function(b){if(a.isOrdinal()&&(J=!1),J){I.on("brushstart",g).on("brush",h).on("brushend",i);var c=b.append("g").attr("class","brush").attr("transform","translate("+a.margins().left+","+a.margins().top+")").call(I.x(a.x()));c.selectAll("rect").attr("height",f()),c.selectAll(".resize").append("path").attr("d",a.resizeHandlePath),a.hasFilter()&&a.redrawBrush(b)}},a.extendBrush=function(){var b=I.extent();return a.round()&&(b[0]=b.map(a.round())[0],b[1]=b.map(a.round())[1],s.select(".brush").call(I.extent(b))),b},a.brushIsEmpty=function(a){return I.empty()||!a||a[1]<=a[0]},a.redrawBrush=function(b){if(J){a.filter()&&a.brush().empty()&&a.brush().extent(a.filter());var c=b.select("g.brush");c.call(a.brush().x(a.x())),c.selectAll("rect").attr("height",f())}a.fadeDeselectedArea()},a.fadeDeselectedArea=function(){},a.resizeHandlePath=function(a){var b=+("e"==a),c=b?1:-1,d=f()/3;return"M"+.5*c+","+d+"A6,6 0 0 "+b+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+b+" "+.5*c+","+2*d+"Z"+"M"+2.5*c+","+(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)},a.clipPadding=function(b){return arguments.length?(O=b,a):O},a.doRender=function(){if(void 0===u)throw new dc.errors.InvalidStateException("Mandatory attribute chart.x is missing on chart[#"+a.anchorName()+"]");return a.resetSvg(),a.dataSet()&&(a.generateG(),k(),b(a.g()),d(a.g()),a.plotData(),a.renderXAxis(a.g()),a.renderYAxis(a.g()),a.renderBrush(a.g()),l()),a},a.doRedraw=function(){return b(a.g()),d(a.g()),a.plotData(),a.elasticY()&&a.renderYAxis(a.g()),(a.elasticX()||M)&&a.renderXAxis(a.g()),a.redrawBrush(a.g()),a},a.subRender=function(){return a.dataSet()&&a.plotData(),a},a.brushOn=function(b){return arguments.length?(J=b,a):J},a.getDataWithinXDomain=function(b){var c=[];return a.isOrdinal()?c=b.all():b.all().forEach(function(b){var d=a.keyAccessor()(b);d>=a.x().domain()[0]&&d<=a.x().domain()[1]&&c.push(b)}),c},a.focus=function(b){M=!0,n(b)?a.x().domain(b):a.x().domain(a.xOriginalDomain()),a.rescale(),a.redraw(),n(b)||(M=!1)},a.refocused=function(){return M},a.focusChart=function(b){return arguments.length?(A=b,a.on("filtered",function(a){dc.events.trigger(function(){A.focus(a.filter()),A.filter(a.filter()),dc.redrawAll(a.chartGroup())})}),a):A},a},dc.colorChart=function(a){var b=d3.scale.category20c(),c=[0,b.range().length],d=function(d){var e=c[0],f=c[1];if(isNaN(d)&&(d=0),null===f)return b(d);var g=a.colors().range().length,h=(f-e)/g,i=Math.abs(Math.min(g-1,Math.round((d-e)/h)));return a.colors()(i)},e=function(a,b){return b};return a.colors=function(d){if(!arguments.length)return b;if(d instanceof Array){b=d3.scale.ordinal().range(d);for(var e=[],f=0;f<d.length;++f)e.push(f);b.domain(e)}else b=d;return c=[0,b.range().length],a},a.colorCalculator=function(b){return arguments.length?(d=b,a):d},a.getColor=function(a,b){return d(e(a,b))},a.colorAccessor=function(b){return arguments.length?(e=b,a):e},a.colorDomain=function(b){return arguments.length?(c=b,a):c},a},dc.stackableChart=function(a){function b(){var b=[];if(a.x()){var c=a.x().domain();a.stackLayers().forEach(function(a){a.points.forEach(function(a){a.x>=c[0]&&a.x<=c[1]&&b.push(a)})})}else a.stackLayers().forEach(function(a){b=b.concat(a.points)});return b}function c(b,c){return a.getKeyAccessorByIndex(b)(c)}function d(b,c){return a.getValueAccessorByIndex(b)(c)}function e(a,b){for(var e=0;e<a.length;++e){var f=a[e],g=c(b,f),h=d(b,f);j.setDataPoint(b,e,{data:f,x:g,y:h})}}var f,g,h,i,j=new dc.utils.GroupStack,k=d3.layout.stack().offset("zero").order("default").values(function(a){return a.points});return a.stack=function(b,c,d){return"string"==typeof c?a.setGroupName(b,c,d):"function"==typeof c&&(d=c),j.setDefaultAccessor(a.valueAccessor()),j.addGroup(b,d),a.expireCache(),a},a.expireCache=function(){return f=null,g=null,h=null,i=null,a},a.allGroups=function(){if(null===f){f=[],f.push(a.group());for(var b=0;b<j.size();++b)f.push(j.getGroupByIndex(b))}return f},a.allValueAccessors=function(){if(null===g){g=[],g.push(a.valueAccessor());for(var b=0;b<j.size();++b)g.push(j.getAccessorByIndex(b))}return g},a.getValueAccessorByIndex=function(b){return a.allValueAccessors()[b]},a.yAxisMin=function(){var c,d=b();return c=d3.min(d,function(a){return a.y+a.y0<a.y0?a.y+a.y0:a.y0}),c=dc.utils.subtract(c,a.yAxisPadding())},a.yAxisMax=function(){var c,d=b();return c=d3.max(d,function(a){return a.y+a.y0}),c=dc.utils.add(c,a.yAxisPadding())},a.allKeyAccessors=function(){if(null===h){h=[],h.push(a.keyAccessor());for(var b=0;b<j.size();++b)h.push(a.keyAccessor())}return h},a.getKeyAccessorByIndex=function(b){return a.allKeyAccessors()[b]},a.xAxisMin=function(){for(var b=null,c=a.allGroups(),d=0;d<c.length;++d){var e=c[d],f=dc.utils.groupMin(e,a.getKeyAccessorByIndex(d));(null===b||b>f)&&(b=f)}return dc.utils.subtract(b,a.xAxisPadding())},a.xAxisMax=function(){for(var b=null,c=a.allGroups(),d=0;d<c.length;++d){var e=c[d],f=dc.utils.groupMax(e,a.getKeyAccessorByIndex(d));(null===b||f>b)&&(b=f)}return dc.utils.add(b,a.xAxisPadding())},a.calculateDataPointMatrixForAll=function(){for(var b=a.allGroups(),c=0;c<b.length;++c){var d=b[c],f=d.all();e(f,c)}},a.getChartStack=function(){return j},dc.override(a,"valueAccessor",function(b){return arguments.length?(a.expireCache(),a._valueAccessor(b)):a._valueAccessor()}),dc.override(a,"keyAccessor",function(b){return arguments.length?(a.expireCache(),a._keyAccessor(b)):a._keyAccessor()}),a.stackLayout=function(b){return arguments.length?(k=b,a):k},a.stackLayers=function(b){return arguments.length?(i=b,void 0):(null===i&&(a.calculateDataPointMatrixForAll(),i=a.stackLayout()(j.toLayers())),i)},a.legendables=function(){var b=[];return f.forEach(function(c,d){b.push(dc.utils.createLegendable(a,c,d,a.getValueAccessorByIndex(d)))}),b},a},dc.abstractBubbleChart=function(a){var b=.3,c=10;a.BUBBLE_NODE_CLASS="node",a.BUBBLE_CLASS="bubble",a.MIN_RADIUS=10,a=dc.colorChart(a),a.renderLabel(!0),a.renderTitle(!1);var d=d3.scale.linear().domain([0,100]),e=function(a){return a.r};a.r=function(b){return arguments.length?(d=b,a):d},a.radiusValueAccessor=function(b){return arguments.length?(e=b,a):e},a.rMin=function(){var b=d3.min(a.group().all(),function(b){return a.radiusValueAccessor()(b)});return b},a.rMax=function(){var b=d3.max(a.group().all(),function(b){return a.radiusValueAccessor()(b)});return b},a.bubbleR=function(b){var c=a.radiusValueAccessor()(b),d=a.r()(c);return(isNaN(d)||0>=c)&&(d=0),d};var f=function(b){return a.label()(b)},g=function(b){return a.bubbleR(b)>c?1:0};a.doRenderLabel=function(b){if(a.renderLabel()){var c=b.select("text");c.empty()&&(c=b.append("text").attr("text-anchor","middle").attr("dy",".3em").on("click",a.onClick)),c.attr("opacity",0).text(f),dc.transition(c,a.transitionDuration()).attr("opacity",g)}},a.doUpdateLabels=function(b){if(a.renderLabel()){var c=b.selectAll("text").text(f);dc.transition(c,a.transitionDuration()).attr("opacity",g)}};var h=function(b){return a.title()(b)};return a.doRenderTitles=function(b){if(a.renderTitle()){var c=b.select("title");c.empty()&&b.append("title").text(h)}},a.doUpdateTitles=function(b){a.renderTitle()&&b.selectAll("title").text(h)},a.minRadiusWithLabel=function(b){return arguments.length?(c=b,a):c},a.maxBubbleRelativeSize=function(c){return arguments.length?(b=c,a):b},a.initBubbleColor=function(b,c){return this[dc.constants.NODE_INDEX_NAME]=c,a.getColor(b,c)},a.updateBubbleColor=function(b){return a.getColor(b,this[dc.constants.NODE_INDEX_NAME])},a.fadeDeselectedArea=function(){a.hasFilter()?a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(b){a.isSelectedNode(b)?a.highlightSelected(this):a.fadeDeselected(this)}):a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(){a.resetHighlight(this)})},a.isSelectedNode=function(b){return a.hasFilter(b.key)},a.onClick=function(b){var c=b.key;dc.events.trigger(function(){a.filter(c),dc.redrawAll(a.chartGroup())})},a},dc.pieChart=function(a,b){function c(){if(1/0==D)return C.orderedGroup().top(D);var a=C.group().top(D),b=d3.sum(a,C.valueAccessor()),c=C.group().all(),d=d3.sum(c,C.valueAccessor());return F(a,d-b),a}function d(){if(C.dataSet()){var a=p();w=w?w:d3.min([C.width(),C.height()])/2;var b=C.buildArcs(),d=a(c());if(x){var f=x.selectAll("g."+z).data(d);e(f,b,d),j(d,b),n(f),o()}}}function e(a,b,c){var d=f(a);g(d,b),h(d),i(c,b)}function f(a){var b=a.enter().append("g").attr("class",function(a,b){return z+" _"+b});return b}function g(a,b){var c=a.append("path").attr("fill",function(a,b){return C.getColor(a,b)}).on("click",u).attr("d",function(a,c){return v(a,c,b)});c.transition().duration(C.transitionDuration()).attrTween("d",s)}function h(a){C.renderTitle()&&a.append("title").text(function(a){return C.title()(a)})}function i(a,b){if(C.renderLabel()){var c=x.selectAll("text."+z).data(a);c.exit().remove();var d=c.enter().append("text").attr("class",function(a,b){return z+" _"+b}).on("click",u);dc.transition(d,C.transitionDuration()).attr("transform",function(a){a.innerRadius=C.innerRadius(),a.outerRadius=w;var c=b.centroid(a);return isNaN(c[0])||isNaN(c[1])?"translate(0,0)":"translate("+c+")"}).attr("text-anchor","middle").text(function(a){var b=a.data;return r(b)||q(a)?"":C.label()(a)})}}function j(a,b){k(a,b),l(a,b),m(a)}function k(a,b){var c=x.selectAll("g."+z).data(a).select("path").attr("d",function(a,c){return v(a,c,b)});dc.transition(c,C.transitionDuration(),function(a){a.attrTween("d",s)}).attr("fill",function(a,b){return C.getColor(a,b)})}function l(a,b){if(C.renderLabel()){var c=x.selectAll("text."+z).data(a);dc.transition(c,C.transitionDuration()).attr("transform",function(a){a.innerRadius=C.innerRadius(),a.outerRadius=w;var c=b.centroid(a);return isNaN(c[0])||isNaN(c[1])?"translate(0,0)":"translate("+c+")"}).attr("text-anchor","middle").text(function(a){var b=a.data;return r(b)||q(a)?"":C.label()(a)})}}function m(a){C.renderTitle()&&x.selectAll("g."+z).data(a).select("title").text(function(a){return C.title()(a)})}function n(a){a.exit().remove()}function o(){C.hasFilter()?C.selectAll("g."+z).each(function(a){C.isSelectedSlice(a)?C.highlightSelected(this):C.fadeDeselected(this)}):C.selectAll("g."+z).each(function(){C.resetHighlight(this)})}function p(){return d3.layout.pie().sort(null).value(function(a){return C.valueAccessor()(a)})}function q(a){var b=a.endAngle-a.startAngle;return isNaN(b)||B>b}function r(a){return 0===C.valueAccessor()(a)}function s(a){a.innerRadius=C.innerRadius();var b=this._current;t(b)&&(b={startAngle:0,endAngle:0});var c=d3.interpolate(b,a);return this._current=c(0),function(a){return v(c(a),0,C.buildArcs())}}function t(a){return!a||isNaN(a.startAngle)||isNaN(a.endAngle)}function u(a){C.onClick(a.data)}function v(a,b,c){var d=c(a,b);return d.indexOf("NaN")>=0&&(d="M0,0"),d}var w,x,y=.5,z="pie-slice",A=0,B=y,C=dc.colorChart(dc.baseChart({})),D=1/0,E="Others",F=function(a,b){a.push({key:E,value:b})};return C.label(function(a){return C.keyAccessor()(a.data)}),C.renderLabel(!0),C.title(function(a){return C.keyAccessor()(a.data)+": "+C.valueAccessor()(a.data)}),C.transitionDuration(350),C.doRender=function(){return C.resetSvg(),x=C.svg().append("g").attr("transform","translate("+C.cx()+","+C.cy()+")"),d(),C},C.innerRadius=function(a){return arguments.length?(A=a,C):A},C.radius=function(a){return arguments.length?(w=a,C):w},C.cx=function(){return C.width()/2},C.cy=function(){return C.height()/2},C.buildArcs=function(){return d3.svg.arc().outerRadius(w).innerRadius(A)},C.isSelectedSlice=function(a){return C.hasFilter(C.keyAccessor()(a.data))},C.doRedraw=function(){return d(),C},C.minAngleForLabel=function(a){return arguments.length?(B=a,C):B},C.slicesCap=function(a){return arguments.length?(D=a,C):D},C.othersLabel=function(a){return arguments.length?(E=a,C):E},C.othersGrouper=function(a){return arguments.length?(F=a,C):F},C.anchor(a,b)},dc.barChart=function(a,b){function c(a){return dc.utils.safeNumber(Math.abs(l.y()(a.y+a.y0)-l.y()(a.y0)))}function d(a,b,d){var e=a.selectAll("rect.bar").data(b.points);e.enter().append("rect").attr("class","bar").attr("fill",function(){return l.colors()(d)}).append("title").text(l.title()),l.isOrdinal()&&e.on("click",g),dc.transition(e,l.transitionDuration()).attr("x",function(a){var b=l.x()(a.x);return n&&(b-=i/2),dc.utils.safeNumber(b)}).attr("y",function(a){var b=l.y()(a.y+a.y0);return a.y<0&&(b-=c(a)),dc.utils.safeNumber(b)}).attr("width",i).attr("height",function(a){return c(a)}).select("title").text(l.title()),dc.transition(e.exit(),l.transitionDuration()).attr("height",0).remove()}function e(){if(void 0===i){var a=l.isOrdinal()?f()+1:f(),b=Math.floor((l.xAxisLength()-(a-1)*m)/a);(1/0==b||isNaN(b)||j>b)&&(b=j),i=b}}function f(){return void 0===h&&(h=l.xUnitCount()),h}function g(a){l.onClick(a.data)}var h,i,j=1,k=2,l=dc.stackableChart(dc.coordinateGridChart({})),m=k,n=!1;return dc.override(l,"rescale",function(){l._rescale(),h=void 0,i=void 0,f()}),l.plotData=function(){var a=l.chartBodyG().selectAll("g.stack").data(l.stackLayers());e(),a.enter().append("g").attr("class",function(a,b){return"stack _"+b}),a.each(function(a,b){var c=d3.select(this);d(c,a,b)}),l.stackLayers(null)},l.fadeDeselectedArea=function(){var a=l.chartBodyG().selectAll("rect.bar"),b=l.brush().extent();if(l.isOrdinal())l.hasFilter()?(a.classed(dc.constants.SELECTED_CLASS,function(a){return l.hasFilter(l.keyAccessor()(a.data))}),a.classed(dc.constants.DESELECTED_CLASS,function(a){return!l.hasFilter(l.keyAccessor()(a.data))})):(a.classed(dc.constants.SELECTED_CLASS,!1),a.classed(dc.constants.DESELECTED_CLASS,!1));else if(l.brushIsEmpty(b))a.classed(dc.constants.DESELECTED_CLASS,!1);else{var c=b[0],d=b[1];
a.classed(dc.constants.DESELECTED_CLASS,function(a){var b=l.keyAccessor()(a.data);return c>b||b>=d})}},l.centerBar=function(a){return arguments.length?(n=a,l):n},l.gap=function(a){return arguments.length?(m=a,l):m},l.extendBrush=function(){var a=l.brush().extent();return l.round()&&!n&&(a[0]=a.map(l.round())[0],a[1]=a.map(l.round())[1],l.chartBodyG().select(".brush").call(l.brush().extent(a))),a},dc.override(l,"prepareOrdinalXAxis",function(){return this._prepareOrdinalXAxis(l.xUnitCount()+1)}),l.legendHighlight=function(a){l.select(".chart-body").selectAll("rect.bar").filter(function(){return d3.select(this).attr("fill")==a.color}).classed("highlight",!0),l.select(".chart-body").selectAll("rect.bar").filter(function(){return d3.select(this).attr("fill")!=a.color}).classed("fadeout",!0)},l.legendReset=function(a){l.selectAll(".chart-body").selectAll("rect.bar").filter(function(){return d3.select(this).attr("fill")==a.color}).classed("highlight",!1),l.selectAll(".chart-body").selectAll("rect.bar").filter(function(){return d3.select(this).attr("fill")!=a.color}).classed("fadeout",!1)},l.anchor(a,b)},dc.lineChart=function(a,b){function c(a,b){var c=d3.svg.line().x(function(a){return q.x()(a.x)}).y(function(a){return q.y()(a.y+a.y0)}).interpolate(t).tension(u);a.append("path").attr("class","line").attr("stroke",function(a,b){return q.colors()(b)}).attr("fill",function(a,b){return q.colors()(b)}),dc.transition(b.select("path.line"),q.transitionDuration()).attr("d",function(a){return e(c(a.points))})}function d(a,b){if(r){var c=d3.svg.area().x(function(a){return q.x()(a.x)}).y(function(a){return q.y()(a.y+a.y0)}).y0(function(a){return q.y()(a.y0)});a.append("path").attr("class","area").attr("fill",function(a,b){return q.colors()(b)}).attr("d",function(a){return e(c(a.points))}),dc.transition(b.select("path.area"),q.transitionDuration()).attr("d",function(a){return e(c(a.points))})}}function e(a){return a.indexOf("NaN")>=0?"M0,0":a}function f(a){q.brushOn()||a.each(function(a,b){var c=d3.select(this),d=c.select("g."+m);d.empty()&&(d=c.append("g").attr("class",m)),g(d);var e=d.selectAll("circle."+n).data(d.datum().points);e.enter().append("circle").attr("class",n).attr("r",s).attr("fill",function(){return q.colors()(b)}).style("fill-opacity",1e-6).style("stroke-opacity",1e-6).on("mousemove",function(){var a=d3.select(this);h(a),i(a,d)}).on("mouseout",function(){var a=d3.select(this);j(a),k(d)}).append("title").text(q.title()),e.attr("cx",function(a){return dc.utils.safeNumber(q.x()(a.x))}).attr("cy",function(a){return dc.utils.safeNumber(q.y()(a.y+a.y0))}).select("title").text(q.title()),e.exit().remove()})}function g(a){var b=a.select("path."+o).empty()?a.append("path").attr("class",o):a.select("path."+o);b.style("display","none").attr("stroke-dasharray","5,5");var c=a.select("path."+p).empty()?a.append("path").attr("class",p):a.select("path."+p);c.style("display","none").attr("stroke-dasharray","5,5")}function h(a){return a.style("fill-opacity",.8),a.style("stroke-opacity",.8),a}function i(a,b){var c=a.attr("cx"),d=a.attr("cy");b.select("path."+o).style("display","").attr("d","M0 "+d+"L"+c+" "+d),b.select("path."+p).style("display","").attr("d","M"+c+" "+q.yAxisHeight()+"L"+c+" "+d)}function j(a){a.style("fill-opacity",1e-6).style("stroke-opacity",1e-6)}function k(a){a.select("path."+o).style("display","none"),a.select("path."+p).style("display","none")}var l=5,m="dc-tooltip",n="dot",o="yRef",p="xRef",q=dc.stackableChart(dc.coordinateGridChart({})),r=!1,s=l,t="linear",u=.7;return q.transitionDuration(500),q.plotData=function(){var a=q.chartBodyG().selectAll("g.stack").data(q.stackLayers()),b=a.enter().append("g").attr("class",function(a,b){return"stack _"+b});c(b,a),d(b,a),f(a),q.stackLayers(null)},q.interpolate=function(a){return arguments.length?(t=a,q):t},q.tension=function(a){return arguments.length?(u=a,q):u},q.renderArea=function(a){return arguments.length?(r=a,q):r},q.dotRadius=function(a){return arguments.length?(s=a,q):s},q.legendHighlight=function(a){q.selectAll(".chart-body").selectAll("path").filter(function(){return d3.select(this).attr("fill")==a.color}).classed("highlight",!0),q.selectAll(".chart-body").selectAll("path").filter(function(){return d3.select(this).attr("fill")!=a.color}).classed("fadeout",!0)},q.legendReset=function(a){q.selectAll(".chart-body").selectAll("path").filter(function(){return d3.select(this).attr("fill")==a.color}).classed("highlight",!1),q.selectAll(".chart-body").selectAll("path").filter(function(){return d3.select(this).attr("fill")!=a.color}).classed("fadeout",!1)},q.anchor(a,b)},dc.dataCount=function(a,b){var c=d3.format(",d"),d=dc.baseChart({});return d.doRender=function(){return d.selectAll(".total-count").text(c(d.dimension().size())),d.selectAll(".filter-count").text(c(d.group().value())),d},d.doRedraw=function(){return d.doRender()},d.anchor(a,b)},dc.dataTable=function(a,b){function c(){var a=k.root().selectAll("tbody").data(d(),function(a){return k.keyAccessor()(a)}),b=a.enter().append("tbody");return b.append("tr").attr("class",j).append("td").attr("class",g).attr("colspan",m.length).html(function(a){return k.keyAccessor()(a)}),a.exit().remove(),b}function d(){f||(f=crossfilter.quicksort.by(n));var a=k.dimension().top(l);return d3.nest().key(k.group()).sortKeys(o).sortValues(o).entries(f(a,0,a.length))}function e(a){for(var b=a.order().selectAll("tr."+h).data(function(a){return a.values}),c=b.enter().append("tr").attr("class",h),d=0;d<m.length;++d){var e=m[d];c.append("td").attr("class",i+" _"+d).html(function(a){return e(a)})}return b.exit().remove(),b}var f,g="dc-table-label",h="dc-table-row",i="dc-table-column",j="dc-table-group",k=dc.baseChart({}),l=25,m=[],n=function(a){return a},o=d3.ascending;return k.doRender=function(){return k.selectAll("tbody").remove(),e(c()),k},k.doRedraw=function(){return k.doRender()},k.size=function(a){return arguments.length?(l=a,k):l},k.columns=function(a){return arguments.length?(m=a,k):m},k.sortBy=function(a){return arguments.length?(n=a,k):n},k.order=function(a){return arguments.length?(o=a,k):o},k.anchor(a,b)},dc.bubbleChart=function(a,b){function c(a){var b=a.enter().append("g");b.attr("class",h.BUBBLE_NODE_CLASS).attr("transform",j).append("circle").attr("class",function(a,b){return h.BUBBLE_CLASS+" _"+b}).on("click",h.onClick).attr("fill",h.initBubbleColor).attr("r",0),dc.transition(a,h.transitionDuration()).attr("r",function(a){return h.bubbleR(a)}).attr("opacity",function(a){return h.bubbleR(a)>0?1:0}),h.doRenderLabel(b),h.doRenderTitles(b)}function d(a){dc.transition(a,h.transitionDuration()).attr("transform",j).selectAll("circle."+h.BUBBLE_CLASS).attr("fill",h.updateBubbleColor).attr("r",function(a){return h.bubbleR(a)}).attr("opacity",function(a){return h.bubbleR(a)>0?1:0}),h.doUpdateLabels(a),h.doUpdateTitles(a)}function e(a){a.exit().remove()}function f(a){var b=h.x()(h.keyAccessor()(a))+h.margins().left;return isNaN(b)&&(b=0),b}function g(a){var b=h.margins().top+h.y()(h.valueAccessor()(a));return isNaN(b)&&(b=0),b}var h=dc.abstractBubbleChart(dc.coordinateGridChart({})),i=!1;h.transitionDuration(750);var j=function(a){return"translate("+f(a)+","+g(a)+")"};return h.elasticRadius=function(a){return arguments.length?(i=a,h):i},h.plotData=function(){i&&h.r().domain([h.rMin(),h.rMax()]),h.r().range([h.MIN_RADIUS,h.xAxisLength()*h.maxBubbleRelativeSize()]);var a=h.chartBodyG().selectAll("g."+h.BUBBLE_NODE_CLASS).data(h.group().all());c(a),d(a),e(a),h.fadeDeselectedArea()},h.renderBrush=function(){},h.redrawBrush=function(){h.fadeDeselectedArea()},h.anchor(a,b)},dc.compositeChart=function(a,b){function c(a,b){a.generateG(i.g()),a.g().attr("class",h+" _"+b)}function d(){for(var a=[],b=0;b<j.length;++b)a.push(j[b].yAxisMin());return a}function e(){for(var a=[],b=0;b<j.length;++b)a.push(j[b].yAxisMax());return a}function f(){for(var a=[],b=0;b<j.length;++b)a.push(j[b].xAxisMin());return a}function g(){for(var a=[],b=0;b<j.length;++b)a.push(j[b].xAxisMax());return a}var h="sub",i=dc.coordinateGridChart({}),j=[];return i.transitionDuration(500),dc.override(i,"generateG",function(){for(var a=this._generateG(),b=0;b<j.length;++b){var d=j[b];c(d,b),void 0===d.dimension()&&d.dimension(i.dimension()),void 0===d.group()&&d.group(i.group()),d.chartGroup(i.chartGroup()),d.svg(i.svg()),d.xUnits(i.xUnits()),d.transitionDuration(i.transitionDuration()),d.brushOn(i.brushOn())}return a}),i.plotData=function(){for(var a=0;a<j.length;++a){var b=j[a];void 0===b.g()&&c(b,a),b.x(i.x()),b.y(i.y()),b.xAxis(i.xAxis()),b.yAxis(i.yAxis()),b.plotData(),b.activateRenderlets()}},i.fadeDeselectedArea=function(){for(var a=0;a<j.length;++a){var b=j[a];b.brush(i.brush()),b.fadeDeselectedArea()}},i.compose=function(a){j=a;for(var b=0;b<j.length;++b){var c=j[b];c.height(i.height()),c.width(i.width()),c.margins(i.margins())}return i},i.children=function(){return j},i.yAxisMin=function(){return d3.min(d())},i.yAxisMax=function(){return dc.utils.add(d3.max(e()),i.yAxisPadding())},i.xAxisMin=function(){return dc.utils.subtract(d3.min(f()),i.xAxisPadding())},i.xAxisMax=function(){return dc.utils.add(d3.max(g()),i.xAxisPadding())},i.legendables=function(){for(var a=[],b=0;b<j.length;++b){var c=j[b];c.allGroups().forEach(function(b,d){a.push(dc.utils.createLegendable(c,b,d,c.getValueAccessorByIndex(d)))})}return a},i.legendHighlight=function(a){for(var b=0;b<j.length;++b){var c=j[b];c.legendHighlight(a)}},i.legendReset=function(a){for(var b=0;b<j.length;++b){var c=j[b];c.legendReset(a)}},i.anchor(a,b)},dc.geoChoroplethChart=function(a,b){function c(a){var b=dc.utils.groupMax(n.group(),n.valueAccessor()),c=d();if(e(a)){var g=f(a);l(g,a,c,b),m(g,a,c)}}function d(){for(var a={},b=n.group().all(),c=0;c<b.length;++c)a[n.keyAccessor()(b[c])]=n.valueAccessor()(b[c]);return a}function e(a){return k(a).keyAccessor}function f(a){var b=n.svg().selectAll(g(a)).classed("selected",function(b){return h(a,b)}).classed("deselected",function(b){return i(a,b)}).attr("class",function(b){var c=k(a).name,d=dc.utils.nameToId(k(a).keyAccessor(b)),e=c+" "+d;return h(a,b)&&(e+=" selected"),i(a,b)&&(e+=" deselected"),e});return b}function g(a){return"g.layer"+a+" g."+k(a).name}function h(a,b){return n.hasFilter()&&n.hasFilter(j(a,b))}function i(a,b){return n.hasFilter()&&!n.hasFilter(j(a,b))}function j(a,b){return k(a).keyAccessor(b)}function k(a){return q[a]}function l(a,b,c){var d=a.select("path").attr("fill",function(){var a=d3.select(this).attr("fill");return a?a:"none"}).on("click",function(a){return n.onClick(a,b)});dc.transition(d,n.transitionDuration()).attr("fill",function(a,d){return n.getColor(c[k(b).keyAccessor(a)],d)})}function m(a,b,c){n.renderTitle()&&a.selectAll("title").text(function(a){var d=j(b,a),e=c[d];return n.title()({key:d,value:e})})}var n=dc.colorChart(dc.baseChart({}));n.colorAccessor(function(a){return a});var o,p=d3.geo.path(),q=[];return n.doRender=function(){n.resetSvg();for(var a=0;a<q.length;++a){var b=n.svg().append("g").attr("class","layer"+a),d=b.selectAll("g."+k(a).name).data(k(a).data).enter().append("g").attr("class",k(a).name);d.append("path").attr("fill","white").attr("d",p),d.append("title"),c(a)}o=!1},n.onClick=function(a,b){var c=k(b).keyAccessor(a);dc.events.trigger(function(){n.filter(c),dc.redrawAll(n.chartGroup())})},n.doRedraw=function(){for(var a=0;a<q.length;++a)c(a),o&&n.svg().selectAll("g."+k(a).name+" path").attr("d",p);o=!1},n.overlayGeoJson=function(a,b,c){for(var d=0;d<q.length;++d)if(q[d].name==b)return q[d].data=a,q[d].keyAccessor=c,n;return q.push({name:b,data:a,keyAccessor:c}),n},n.projection=function(a){return p.projection(a),o=!0,n},n.geoJsons=function(){return q},n.removeGeoJson=function(a){for(var b=[],c=0;c<q.length;++c){var d=q[c];d.name!=a&&b.push(d)}return q=b,n},n.anchor(a,b)},dc.bubbleOverlay=function(a,b){function c(){return h=l.select("g."+i),h.empty()&&(h=l.svg().append("g").attr("class",i)),h}function d(){var a=e();m.forEach(function(b){var c=f(b,a),d=c.select("circle."+k);d.empty()&&(d=c.append("circle").attr("class",k).attr("r",0).attr("fill",l.initBubbleColor).on("click",l.onClick)),dc.transition(d,l.transitionDuration()).attr("r",function(a){return l.bubbleR(a)}),l.doRenderLabel(c),l.doRenderTitles(c)})}function e(){var a={};return l.group().all().forEach(function(b){a[l.keyAccessor()(b)]=b}),a}function f(a,b){var c=j+" "+dc.utils.nameToId(a.name),d=h.select("g."+dc.utils.nameToId(a.name));return d.empty()&&(d=h.append("g").attr("class",c).attr("transform","translate("+a.x+","+a.y+")")),d.datum(b[a.name]),d}function g(){var a=e();m.forEach(function(b){var c=f(b,a),d=c.select("circle."+k);dc.transition(d,l.transitionDuration()).attr("r",function(a){return l.bubbleR(a)}).attr("fill",l.updateBubbleColor),l.doUpdateLabels(c),l.doUpdateTitles(c)})}var h,i="bubble-overlay",j="node",k="bubble",l=dc.abstractBubbleChart(dc.baseChart({})),m=[];return l.transitionDuration(750),l.radiusValueAccessor(function(a){return a.value}),l.point=function(a,b,c){return m.push({name:a,x:b,y:c}),l},l.doRender=function(){return h=c(),l.r().range([l.MIN_RADIUS,l.width()*l.maxBubbleRelativeSize()]),d(),l.fadeDeselectedArea(),l},l.doRedraw=function(){return g(),l.fadeDeselectedArea(),l},l.debug=function(a){if(a){var b=l.select("g."+dc.constants.DEBUG_GROUP_CLASS);b.empty()&&(b=l.svg().append("g").attr("class",dc.constants.DEBUG_GROUP_CLASS));var c=b.append("text").attr("x",10).attr("y",20);b.append("rect").attr("width",l.width()).attr("height",l.height()).on("mousemove",function(){var a=d3.mouse(b.node()),d=a[0]+", "+a[1];c.text(d)})}else l.selectAll(".debug").remove();return l},l.anchor(a,b),l},dc.rowChart=function(a,b){function c(){if(!r||s){var a=d3.extent(x.group().all(),x.valueAccessor());a[0]>0&&(a[0]=0),r=d3.scale.linear().domain(a).range([0,x.effectiveWidth()]),y.scale(r)}}function d(){var a=q.select("g.axis");c(),a.empty()&&(a=q.append("g").attr("class","axis").attr("transform","translate(0, "+x.effectiveHeight()+")")),dc.transition(a,x.transitionDuration()).call(y)}function e(){q.selectAll("g.tick").select("line.grid-line").remove(),q.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-x.effectiveHeight()})}function f(){d(),e();var a=q.selectAll("g."+w).data(x.group().all());g(a),h(a),i(a)}function g(a){var b=a.enter().append("g").attr("class",function(a,b){return w+" _"+b});b.append("rect").attr("width",0),k(b),l(a)}function h(a){a.exit().remove()}function i(a){var b=n();rect=a.attr("transform",function(a,c){return"translate(0,"+((c+1)*v+c*b)+")"}).select("rect").attr("height",b).attr("fill",x.getColor).on("click",o).classed("deselected",function(a){return x.hasFilter()?!x.isSelectedRow(a):!1}).classed("selected",function(a){return x.hasFilter()?x.isSelectedRow(a):!1}),dc.transition(rect,x.transitionDuration()).attr("width",function(a){return Math.abs(r(0)-r(x.valueAccessor()(a)))}).attr("transform",p),j(a),l(a)}function j(a){x.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(function(a){return x.title()(a)}))}function k(a){x.renderLabel()&&a.append("text").on("click",o)}function l(a){x.renderLabel()&&(lab=a.select("text").attr("x",t).attr("y",u).attr("class",function(a,b){return w+" _"+b}).text(function(a){return x.label()(a)}),dc.transition(lab,x.transitionDuration()).attr("transform",p))}function m(){return x.group().all().length}function n(){var a=m();return(x.effectiveHeight()-(a+1)*v)/a}function o(a){x.onClick(a)}function p(a){var b=r(x.valueAccessor()(a)),c=r(0),d=b>c?c:b;return"translate("+d+",0)"}var q,r,s,t=10,u=15,v=5,w="row",x=dc.marginable(dc.colorChart(dc.baseChart({}))),y=d3.svg.axis().orient("bottom");return x.doRender=function(){return x.resetSvg(),q=x.svg().append("g").attr("transform","translate("+x.margins().left+","+x.margins().top+")"),d(),e(),f(),x},x.title(function(a){return x.keyAccessor()(a)+": "+x.valueAccessor()(a)}),x.label(function(a){return x.keyAccessor()(a)}),x.x=function(a){return arguments.length?(r=a,x):r},x.doRedraw=function(){return f(),x},x.xAxis=function(){return y},x.gap=function(a){return arguments.length?(v=a,x):v},x.elasticX=function(a){return arguments.length?(s=a,x):s},x.labelOffsetX=function(a){return arguments.length?(t=a,x):t},x.labelOffsetY=function(a){return arguments.length?(u=a,x):u},x.isSelectedRow=function(a){return x.hasFilter(x.keyAccessor()(a))},x.anchor(a,b)},dc.legend=function(){function a(){return i+h}var b,c,d=2,e={},f=0,g=0,h=12,i=5;return e.parent=function(a){return arguments.length?(b=a,e):b},e.render=function(){c=b.svg().append("g").attr("class","dc-legend").attr("transform","translate("+f+","+g+")");var e=c.selectAll("g.dc-legend-item").data(b.legendables()).enter().append("g").attr("class","dc-legend-item").attr("transform",function(b,c){return"translate(0,"+c*a()+")"}).on("mouseover",function(a){b.legendHighlight(a)}).on("mouseout",function(a){b.legendReset(a)});e.append("rect").attr("width",h).attr("height",h).attr("fill",function(a){return a.color}),e.append("text").text(function(a){return a.name}).attr("x",h+d).attr("y",function(){return h/2+(this.clientHeight?this.clientHeight:13)/2-2})},e.x=function(a){return arguments.length?(f=a,e):f},e.y=function(a){return arguments.length?(g=a,e):g},e.gap=function(a){return arguments.length?(i=a,e):i},e.itemHeight=function(a){return arguments.length?(h=a,e):h},e};
>>>>>>> master
